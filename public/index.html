<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Philip Di Fiore</title>
<link rel="stylesheet" href="https://use.typekit.net/ayz4ezz.css" />
<link rel="stylesheet" href="https://use.typekit.net/iof8yta.css" />
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
</head>
<body>
<div id="root"></div>

<style>
:root {
  --bg: #fff;
  --text: #000;
  --text-dim: #999;
  --border: #000;
  --font-display: 'itc-avant-garde-gothic-pro', 'Century Gothic', sans-serif;
  --font-body: 'DM Sans', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: #fff;
  color: #000;
  font-family: var(--font-body);
}

.site-wrap {
  min-height: 100vh;
  background: #fff;
  display: flex;
  flex-direction: column;
}

/* Header */
.site-header {
  padding: 4rem 3rem 3rem;
  text-align: center;
  background: #fff;
  border-bottom: 1px solid #000;
}

.site-header.landing {
  padding: 6rem 3rem 3rem;
  border-bottom: none;
}

.site-title {
  font-family: var(--font-display);
  font-size: 5.5rem;
  font-weight: 800;
  color: #000;
  letter-spacing: -0.06em;
  text-transform: uppercase;
  line-height: 0.9;
  display: block;
  cursor: pointer;
}

.site-subtitle {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  color: #999;
  text-transform: none;
  letter-spacing: 0.02em;
  margin-top: 1.5rem;
  display: block;
  font-style: italic;
}

/* Navigation Tabs */
.tab-nav {
  display: flex;
  justify-content: center;
  gap: 0;
  padding: 0;
  border-bottom: 1px solid #000;
  background: #fff;
}

.tab-btn {
  font-family: var(--font-body);
  font-size: 0.85rem;
  font-weight: 400;
  letter-spacing: 0;
  text-transform: none;
  padding: 1rem 2.5rem;
  border: none;
  border-right: 1px solid #000;
  background: #fff;
  color: #999;
  cursor: pointer;
  transition: all 0.15s;
}

.tab-btn:last-child { border-right: none; }

.tab-btn:hover { color: #000; }

.tab-btn.active {
  color: #000;
  font-weight: 600;
}

/* Content Area */
.content {
  max-width: 1100px;
  margin: 0 auto;
  padding: 4rem 3rem;
  flex: 1;
  width: 100%;
}

.content.landing {
  padding: 2rem 3rem 4rem;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* AI Chat Section - Landing Page */
.chat-section {
  max-width: 800px;
  width: 100%;
  margin: 0 auto;
}

.chat-label {
  font-family: 'itc-avant-garde-gothic-pro', var(--font-display);
  font-size: 2rem;
  font-weight: 700;
  color: #000;
  text-transform: uppercase;
  letter-spacing: -0.02em;
  margin-bottom: 1.5rem;
  text-align: center;
}

.chat-area {
  background: #fff;
  border: 1px solid #000;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  min-height: 450px;
  max-height: 550px;
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 2rem;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  background: #fff;
}

.msg {
  max-width: 85%;
  padding: 0;
  font-size: 0.95rem;
  line-height: 1.7;
}

.msg.user {
  align-self: flex-end;
  background: none;
  color: #000;
  font-weight: 400;
  text-align: right;
  border-bottom: 2px solid #000;
  padding-bottom: 1rem;
}

.msg.assistant {
  align-self: flex-start;
  background: none;
  font-style: normal;
  color: #333;
  font-family: var(--font-body);
  font-size: 0.85rem;
  font-weight: 400;
}

.msg.assistant p {
  margin-bottom: 1em;
}

.msg.assistant p:last-child {
  margin-bottom: 0;
}

.chat-input-row {
  padding: 0;
  border-top: 1px solid #000;
  display: flex;
  gap: 0;
}

.chat-input {
  flex: 1;
  background: #fff;
  border: none;
  padding: 1.5rem 1.5rem;
  color: #000;
  font-family: var(--font-body);
  font-size: 1rem;
  outline: none;
}

.chat-input::placeholder { color: #ccc; }

.send-btn {
  background: #000;
  border: none;
  border-left: 1px solid #000;
  padding: 1.5rem 2.5rem;
  color: #fff;
  font-family: var(--font-body);
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
}
.send-btn:hover { background: #333; }
.send-btn:disabled { opacity: 0.3; cursor: not-allowed; }

/* Preset Question Chips */
.preset-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 0.6rem;
  margin-top: 2rem;
  justify-content: center;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

.chip {
  background: #fff;
  border: 1px solid #000;
  padding: 0.5rem 1rem;
  font-size: 0.75rem;
  color: #666;
  cursor: pointer;
  transition: all 0.15s;
  font-family: var(--font-body);
  text-align: center;
}

/* Color sequence for hover (reverse): Red, Yellow, Blue, Green, Orange */
.chip:nth-child(5n+1):hover { background: #ff432e; color: #fff; }
.chip:nth-child(5n+2):hover { background: #f0ff00; color: #000; }
.chip:nth-child(5n+3):hover { background: #4abbff; color: #fff; }
.chip:nth-child(5n+4):hover { background: #1db406; color: #fff; }
.chip:nth-child(5n+5):hover { background: #ff8d00; color: #fff; }

/* Go to Site Button */
.go-to-site-btn {
  display: inline-block;
  margin-top: 2.5rem;
  padding: 1rem 2.5rem;
  background: #000;
  color: #fff;
  font-family: var(--font-display);
  font-size: 0.85rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  text-decoration: none;
  border: 1px solid #000;
  cursor: pointer;
  transition: all 0.15s;
  text-align: center;
}

.go-to-site-btn:hover {
  background: #fff;
  color: #000;
}

/* Loading dots */
.dots {
  display: inline-flex;
  gap: 6px;
  align-items: center;
  padding: 0.5rem 0;
}

.dots span {
  width: 4px;
  height: 4px;
  background: #000;
  border-radius: 50%;
  animation: pulse 1.2s infinite;
}

.dots span:nth-child(2) { animation-delay: 0.2s; }
.dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes pulse {
  0%, 80%, 100% { opacity: 0.15; }
  40% { opacity: 1; }
}

/* Project Grid */
.project-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0;
  border: 1px solid #000;
}

.project-card {
  background: #fff;
  border-right: 1px solid #000;
  border-bottom: 1px solid #000;
  padding: 2rem 1.5rem;
  cursor: pointer;
  transition: all 0.15s;
  position: relative;
  text-decoration: none;
  color: inherit;
  display: block;
  min-height: 140px;
}

.project-card:nth-child(3n) { border-right: none; }

/* Color sequence for hover: Orange, Green, Blue, Yellow, Red */
.project-card:nth-child(5n+1):hover { background: #ff8d00; color: #fff; }
.project-card:nth-child(5n+2):hover { background: #1db406; color: #fff; }
.project-card:nth-child(5n+3):hover { background: #4abbff; color: #fff; }
.project-card:nth-child(5n+4):hover { background: #f0ff00; color: #000; }
.project-card:nth-child(5n+5):hover { background: #ff432e; color: #fff; }

.project-card:nth-child(5n+4):hover .project-subtitle { color: #666; }
.project-card:hover .project-subtitle { color: rgba(255,255,255,0.7); }
.project-card:nth-child(5n+4):hover .project-subtitle { color: rgba(0,0,0,0.5); }

.project-card .project-title {
  font-family: var(--font-display);
  font-size: 1.15rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: -0.02em;
  margin-bottom: 0.5rem;
  line-height: 1.1;
}

.project-card .project-subtitle {
  font-family: var(--font-body);
  font-size: 0.8rem;
  color: #999;
  letter-spacing: 0;
  font-weight: 400;
  font-style: italic;
}

/* Hover Image Preview */
.hover-image {
  position: fixed;
  pointer-events: none;
  z-index: 1000;
  width: 300px;
  height: auto;
  max-height: 400px;
  object-fit: cover;
  border: 1px solid #000;
  opacity: 0;
  transition: opacity 0.15s ease;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
}

.hover-image.visible {
  opacity: 1;
}

/* About Page */
.about-content {
  max-width: 700px;
  margin: 0 auto;
}

.about-content p {
  font-family: var(--font-body);
  font-size: 0.85rem;
  line-height: 1.7;
  margin-bottom: 1.5rem;
  color: #444;
}

/* Apps Page */
.apps-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 2rem;
}

.app-card {
  text-decoration: none;
  color: inherit;
  display: block;
}

/* Color sequence for app card hover: Red, Green, Yellow, Orange */
.app-card:nth-child(4n+1):hover .app-header { background: #ff432e; }
.app-card:nth-child(4n+2):hover .app-header { background: #1db406; }
.app-card:nth-child(4n+3):hover .app-header { background: #f0ff00; }
.app-card:nth-child(4n+3):hover .app-header .app-header-title { color: #000; }
.app-card:nth-child(4n+4):hover .app-header { background: #ff8d00; }

.app-header {
  width: 100%;
  height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #fff;
  border: 1px solid #000;
  transition: background 0.15s;
}

.app-header-title {
  font-family: var(--font-display);
  font-size: 3.5rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: -0.04em;
  color: #000;
  text-align: center;
  padding: 1rem;
  line-height: 1;
  transition: color 0.15s;
}

.app-card:hover .app-header-title {
  color: #fff;
}

.app-card-content {
  padding: 1rem 0 0 0;
}

.app-card .app-title {
  font-family: var(--font-display);
  font-size: 1.2rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: -0.02em;
  margin-bottom: 0.5rem;
}

.app-card .app-desc {
  font-size: 0.85rem;
  color: #666;
  line-height: 1.6;
}

/* Detail Page */
.detail-page {
  max-width: 900px;
  margin: 0 auto;
}

.detail-back {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-family: var(--font-body);
  font-size: 0.85rem;
  color: #999;
  text-decoration: none;
  margin-bottom: 2rem;
  cursor: pointer;
  transition: color 0.15s;
}

.detail-back:hover { color: #000; }

.video-container {
  position: relative;
  padding-bottom: 56.25%;
  height: 0;
  overflow: hidden;
  border: 1px solid #000;
  margin-bottom: 2rem;
}

.detail-image {
  margin-bottom: 2rem;
  border: 1px solid #000;
}

.detail-image img {
  width: 100%;
  height: auto;
  display: block;
}

.video-container iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.detail-title {
  font-family: var(--font-display);
  font-size: 2rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: -0.03em;
  margin-bottom: 1rem;
}

.detail-caption {
  font-family: var(--font-body);
  font-size: 0.85rem;
  line-height: 1.7;
  color: #444;
}

.detail-caption a { color: #000; }

/* Footer */
.site-footer {
  text-align: center;
  padding: 3rem;
  border-top: 1px solid #000;
  background: #fff;
}

.site-footer.landing {
  border-top: none;
  padding-top: 2rem;
}

.footer-contact {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 2rem;
  margin-bottom: 1.5rem;
}

.footer-contact a {
  color: #000;
  text-decoration: none;
  font-size: 0.9rem;
  transition: color 0.15s;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.footer-contact a:hover { color: #666; }

.footer-contact svg {
  width: 20px;
  height: 20px;
}

.footer-copyright {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  color: #999;
}

/* ==================== RESPONSIVE / MOBILE ==================== */

/* Tablet breakpoint (900px and below) */
@media (max-width: 900px) {
  /* Header */
  .site-header {
    padding: 3rem 2rem 2rem;
  }

  .site-header.landing {
    padding: 4rem 2rem 2rem;
  }

  .site-title {
    font-size: 4rem;
  }

  /* Projects Grid - 2 columns on tablet */
  .project-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .project-card:nth-child(3n) {
    border-right: 1px solid #000;
  }

  .project-card:nth-child(2n) {
    border-right: none;
  }

  /* Apps Grid - single column on tablet */
  .apps-grid {
    grid-template-columns: 1fr;
  }

  .app-card {
    border-right: none !important;
  }

  .app-header {
    height: 180px;
  }

  .app-header-title {
    font-size: 2.5rem;
  }

  /* Content area */
  .content {
    padding: 3rem 2rem;
  }

  /* Chat area */
  .chat-area {
    min-height: 400px;
    max-height: 500px;
  }
}

/* Mobile breakpoint (600px and below) */
@media (max-width: 600px) {
  /* Header - Mobile */
  .site-header {
    padding: 2.5rem 1.25rem 1.5rem;
  }

  .site-header.landing {
    padding: 3rem 1.25rem 1.5rem;
  }

  .site-title {
    font-size: 2.2rem;
    letter-spacing: -0.04em;
  }

  .site-subtitle {
    font-size: 0.6rem;
    margin-top: 1rem;
  }

  /* Navigation - Mobile */
  .tab-nav {
    flex-wrap: nowrap;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .tab-nav::-webkit-scrollbar {
    display: none;
  }

  .tab-btn {
    padding: 0.85rem 1.5rem;
    font-size: 0.8rem;
    flex-shrink: 0;
    white-space: nowrap;
  }

  /* Content - Mobile */
  .content {
    padding: 1.5rem 1.25rem 2rem;
  }

  .content.landing {
    padding: 1rem 1.25rem 2rem;
  }

  /* Chat Section - Mobile */
  .chat-section {
    width: 100%;
  }

  .chat-label {
    font-size: 1.3rem;
    margin-bottom: 1rem;
  }

  .chat-area {
    min-height: 320px;
    max-height: 400px;
  }

  .chat-messages {
    padding: 1.25rem;
    gap: 1rem;
  }

  .msg {
    max-width: 95%;
    font-size: 0.9rem;
    line-height: 1.6;
  }

  .msg.user {
    padding-bottom: 0.75rem;
  }

  .msg.assistant {
    font-size: 0.82rem;
  }

  .chat-input-row {
    flex-direction: column;
  }

  .chat-input {
    padding: 1rem 1.25rem;
    font-size: 1rem; /* Prevents iOS zoom on focus */
    border-bottom: 1px solid #000;
  }

  .send-btn {
    padding: 1rem 1.5rem;
    border-left: none;
    font-size: 0.85rem;
  }

  /* Preset Chips - Mobile */
  .preset-chips {
    gap: 0.5rem;
    margin-top: 1.5rem;
    max-width: 100%;
  }

  .chip {
    padding: 0.6rem 0.9rem;
    font-size: 0.7rem;
  }

  /* Go to Site Button - Mobile */
  .go-to-site-btn {
    margin-top: 2rem;
    padding: 0.9rem 2rem;
    font-size: 0.8rem;
    width: 100%;
    max-width: 280px;
  }

  /* Projects Grid - Single column on mobile */
  .project-grid {
    grid-template-columns: 1fr;
  }

  .project-card {
    border-right: none !important;
    min-height: 100px;
    padding: 1.5rem 1.25rem;
  }

  .project-card .project-title {
    font-size: 1rem;
  }

  .project-card .project-subtitle {
    font-size: 0.75rem;
  }

  /* Detail Page - Mobile */
  .detail-page {
    max-width: 100%;
  }

  .detail-back {
    font-size: 0.8rem;
    margin-bottom: 1.5rem;
  }

  .detail-title {
    font-size: 1.3rem;
    margin-bottom: 0.75rem;
  }

  .detail-caption {
    font-size: 0.82rem;
    line-height: 1.65;
  }

  .video-container {
    margin-bottom: 1.5rem;
  }

  /* About Page - Mobile */
  .about-content {
    max-width: 100%;
  }

  .about-content p {
    font-size: 0.82rem;
    line-height: 1.65;
    margin-bottom: 1.25rem;
  }

  /* Apps Page - Mobile */
  .apps-grid {
    gap: 1.5rem;
  }

  .app-header {
    height: 140px;
  }

  .app-header-title {
    font-size: 2rem;
    padding: 0.75rem;
  }

  .app-card-content {
    padding: 0.75rem 0 0 0;
  }

  .app-card .app-desc {
    font-size: 0.8rem;
  }

  /* Footer - Mobile */
  .site-footer {
    padding: 2rem 1.25rem;
  }

  .site-footer.landing {
    padding-top: 1.5rem;
  }

  .footer-contact {
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1.25rem;
  }

  .footer-contact a {
    font-size: 0.85rem;
  }

  .footer-copyright {
    font-size: 0.65rem;
  }

  /* Hide hover image on mobile */
  .hover-image {
    display: none;
  }
}

/* Small mobile breakpoint (380px and below) */
@media (max-width: 380px) {
  .site-title {
    font-size: 1.8rem;
  }

  .chat-label {
    font-size: 1.1rem;
  }

  .chip {
    padding: 0.5rem 0.7rem;
    font-size: 0.65rem;
  }

  .tab-btn {
    padding: 0.75rem 1rem;
    font-size: 0.75rem;
  }

  .app-header-title {
    font-size: 1.6rem;
  }
}

/* Touch device fixes - disable hover effects, use persistent colors on mobile */
@media (hover: none) {
  /* Disable hover colors on project cards - colors applied via JS */
  .project-card:hover {
    background: inherit;
    color: inherit;
  }

  .project-card:hover .project-subtitle {
    color: inherit;
  }

  /* Mobile color classes for project cards (applied via JS) */
  .project-card.mobile-color-orange { background: #ff8d00; color: #fff; }
  .project-card.mobile-color-orange .project-subtitle { color: rgba(255,255,255,0.7); }

  .project-card.mobile-color-green { background: #1db406; color: #fff; }
  .project-card.mobile-color-green .project-subtitle { color: rgba(255,255,255,0.7); }

  .project-card.mobile-color-blue { background: #4abbff; color: #fff; }
  .project-card.mobile-color-blue .project-subtitle { color: rgba(255,255,255,0.7); }

  .project-card.mobile-color-yellow { background: #f0ff00; color: #000; }
  .project-card.mobile-color-yellow .project-subtitle { color: rgba(0,0,0,0.5); }

  .project-card.mobile-color-red { background: #ff432e; color: #fff; }
  .project-card.mobile-color-red .project-subtitle { color: rgba(255,255,255,0.7); }

  /* Active state - invert to white for feedback */
  .project-card:active {
    background: #fff !important;
    color: #000 !important;
  }
  .project-card:active .project-subtitle {
    color: #999 !important;
  }

  /* Chips - disable hover, use persistent colors (applied via JS) */
  .chip:hover {
    background: inherit;
    color: inherit;
  }

  /* Mobile color classes for chips (applied via JS) */
  .chip.mobile-color-orange { background: #ff8d00; color: #fff; border-color: #ff8d00; }
  .chip.mobile-color-green { background: #1db406; color: #fff; border-color: #1db406; }
  .chip.mobile-color-blue { background: #4abbff; color: #fff; border-color: #4abbff; }
  .chip.mobile-color-yellow { background: #f0ff00; color: #000; border-color: #f0ff00; }
  .chip.mobile-color-red { background: #ff432e; color: #fff; border-color: #ff432e; }

  /* Active state - invert to white for feedback */
  .chip:active {
    background: #fff !important;
    color: #000 !important;
    border-color: #000 !important;
  }

  /* App cards - disable hover, use active */
  .app-card:hover .app-header {
    background: #fff;
  }

  .app-card:hover .app-header-title {
    color: #000;
  }

  .app-card:nth-child(4n+1):active .app-header { background: #ff432e; }
  .app-card:nth-child(4n+2):active .app-header { background: #1db406; }
  .app-card:nth-child(4n+3):active .app-header { background: #f0ff00; }
  .app-card:nth-child(4n+4):active .app-header { background: #ff8d00; }
  .app-card:active .app-header-title { color: #fff; }
  .app-card:nth-child(4n+3):active .app-header-title { color: #000; }

  /* Buttons */
  .go-to-site-btn:hover {
    background: #000;
    color: #fff;
  }

  .go-to-site-btn:active {
    background: #fff;
    color: #000;
  }

  .send-btn:hover {
    background: #000;
  }

  .send-btn:active {
    background: #333;
  }

  /* Hide hover image */
  .hover-image {
    display: none;
  }
}

/* iOS Safari specific fixes */
@supports (-webkit-touch-callout: none) {
  /* Prevent iOS zoom on input focus */
  .chat-input {
    font-size: 16px;
  }

  /* Fix for iOS momentum scrolling */
  .chat-messages {
    -webkit-overflow-scrolling: touch;
  }

  /* Fix for safe area (notch) */
  .site-wrap {
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }

  .site-footer {
    padding-bottom: calc(2rem + env(safe-area-inset-bottom));
  }

  @media (max-width: 600px) {
    .site-footer {
      padding-bottom: calc(1.5rem + env(safe-area-inset-bottom));
    }
  }
}

/* Landscape mobile orientation */
@media (max-width: 900px) and (orientation: landscape) {
  .site-header {
    padding: 1.5rem 2rem 1rem;
  }

  .site-header.landing {
    padding: 2rem 2rem 1rem;
  }

  .chat-area {
    min-height: 250px;
    max-height: 300px;
  }

  .go-to-site-btn {
    margin-top: 1.5rem;
  }
}
</style>

<script>
// ==================== CONFIGURATION ====================

const SUPABASE_URL = 'https://gjvvbofpkxuicrpshxun.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqdnZib2Zwa3h1aWNycHNoeHVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNzY1NzcsImV4cCI6MjA4NTc1MjU3N30.igGl_64MuqL-0VsLE4NibmMq1hPxnZ_WusRrM043n5M';
const EDGE_FUNCTION_URL = `${SUPABASE_URL}/functions/v1/artificial-philip`;

// Preset questions for the chat
const PRESET_QUESTIONS = [
  "Tell me about yourself",
  "Tell me about your films",
  "Who are your influences?",
  "What interests you?",
  "You make apps too?",
  "What's your creative process?"
];

// Apps data
const APPS = [
  {
    id: 'wolves',
    title: 'Wolves in the Piano',
    desc: 'Chat with 94 creative masters about their process. Features AI conversations with artists, writers, and filmmakers.',
    image: 'https://images.unsplash.com/photo-1507838153414-b4b713384a76?w=600&h=400&fit=crop',
    url: 'https://wolvesinthepiano.com'
  },
  {
    id: 'ideamachine',
    title: 'The Idea Machine',
    desc: 'Capture ideas and build them into reality. A tool for developing creative concepts.',
    image: 'https://images.unsplash.com/photo-1455849318743-b2233052fcff?w=600&h=400&fit=crop',
    url: 'https://ideamachineapp.com'
  },
  {
    id: 'plotter',
    title: 'Plotter',
    desc: 'Your story builder. A tool designed to assist in creating narratives and stories.',
    image: 'https://images.unsplash.com/photo-1456324504439-367cee3b3c32?w=600&h=400&fit=crop',
    url: 'https://goplotter.com'
  },
  {
    id: 'superzero',
    title: 'Super Zero',
    desc: 'Smart note-taking with natural language parsing, kanban boards, and calendar integration.',
    image: 'https://images.unsplash.com/photo-1484480974693-6ca0a78fb36b?w=600&h=400&fit=crop',
    url: 'https://superzeroapp.com'
  }
];

// About content
const ABOUT_TEXT = `
<p>Philip Di Fiore is an award-winning director, filmmaker, and photographer based in New York.</p>
<p>His documentary <em>The Buffalo Hunt</em> won Best Feature Documentary at the Prague Film Awards and Best Director at the Milan International Film Festival. The New York Times hailed the film as "a striking, poetic look at the Lakota Sioux."</p>
<p>His documentary <em>Stranger: Bernie Worrell on Earth</em> premiered at Slamdance and features David Byrne, George Clinton, and Yasiin Bey. A 35mm print is part of The Academy of Motion Picture Arts and Sciences permanent collection.</p>
<p>His music videos have drawn comparisons to David Lynch, Alfred Hitchcock, and Martin Scorsese. He has directed commercial content for Ralph Lauren, JetBlue, Mattel, Spotify, and major record labels.</p>
`;

// Contact info
const CONTACT = {
  email: 'phil@philipdifiore.com',
  instagram: 'https://instagram.com/philipdifiore'
};

// ==================== STATE ====================

let projects = [];
let currentView = 'landing'; // 'landing', 'projects', 'about', 'apps', 'detail'
let currentProject = null;
let chatMessages = [];
let chatLoading = false;

const root = document.getElementById('root');

// ==================== API FUNCTIONS ====================

async function fetchProjects() {
  const res = await fetch(`${SUPABASE_URL}/rest/v1/projects?select=*&order=display_order.asc,created_at.desc`, {
    headers: {
      'apikey': SUPABASE_ANON_KEY,
      'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
    }
  });
  return res.json();
}

async function sendChatMessage(userMessage) {
  // Clear previous messages and start fresh each time
  chatMessages = [{ role: 'user', content: userMessage }];
  chatLoading = true;
  render();

  try {
    const response = await fetch(EDGE_FUNCTION_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ messages: chatMessages })
    });

    const data = await response.json();

    if (data.error) {
      throw new Error(data.error);
    }

    // Start typewriter effect
    chatLoading = false;
    chatMessages = [{ role: 'assistant', content: '', typing: true }];
    render();

    await typewriterEffect(data.response);

  } catch (error) {
    console.error('Chat error:', error);
    chatLoading = false;
    chatMessages = [{
      role: 'assistant',
      content: "Sorry, I'm having trouble connecting right now. Please try again in a moment."
    }];
    render();
  }
}

async function typewriterEffect(fullText) {
  // Convert paragraph breaks to HTML - split on double newlines or after sentences that end a thought
  const formattedText = fullText
    .replace(/\n\n/g, '</p><p>')  // Double newlines become paragraph breaks
    .replace(/\n/g, '<br>')        // Single newlines become line breaks
    .replace(/^/, '<p>')           // Start with paragraph
    .replace(/$/, '</p>');         // End with paragraph

  const chars = formattedText.split('');
  let currentText = '';
  const speed = 15; // milliseconds per character

  for (let i = 0; i < chars.length; i++) {
    currentText += chars[i];
    chatMessages = [{ role: 'assistant', content: currentText, typing: i < chars.length - 1 }];

    // Update just the message content without full re-render for performance
    const msgElement = document.querySelector('.chat-messages .msg.assistant');
    if (msgElement) {
      msgElement.innerHTML = currentText;
    }

    // Skip delay for HTML tags
    if (chars[i] === '<') {
      // Fast-forward through the tag
      while (i < chars.length - 1 && chars[i] !== '>') {
        i++;
        currentText += chars[i];
      }
      if (msgElement) {
        msgElement.innerHTML = currentText;
      }
    } else {
      await new Promise(resolve => setTimeout(resolve, speed));
    }
  }

  // Final render to ensure state is synced
  chatMessages = [{ role: 'assistant', content: formattedText, typing: false }];
}

// ==================== HELPER FUNCTIONS ====================

function decodeHTML(html) {
  const txt = document.createElement('textarea');
  txt.innerHTML = html;
  return txt.value;
}

// Mobile color helpers
// Project cards: Orange, Green, Blue, Yellow, Red (matches desktop hover pattern)
const PROJECT_COLORS = ['orange', 'green', 'blue', 'yellow', 'red'];
// Chips: Red, Yellow, Blue, Green, Orange (reverse pattern, matches desktop hover)
const CHIP_COLORS = ['red', 'yellow', 'blue', 'green', 'orange'];

function isTouchDevice() {
  return window.matchMedia('(hover: none)').matches;
}

function applyMobileColors() {
  if (!isTouchDevice()) return;

  // Apply colors to project cards (same order as desktop hover: 1=orange, 2=green, etc.)
  document.querySelectorAll('.project-card').forEach((card, index) => {
    const color = PROJECT_COLORS[index % 5];
    card.classList.add(`mobile-color-${color}`);
  });

  // Apply colors to preset chips (same order as desktop hover: 1=red, 2=yellow, etc.)
  document.querySelectorAll('.chip').forEach((chip, index) => {
    const color = CHIP_COLORS[index % 5];
    chip.classList.add(`mobile-color-${color}`);
  });
}

// ==================== RENDER FUNCTIONS ====================

function render() {
  if (currentView === 'landing') {
    renderLanding();
  } else {
    renderSite();
  }
}

function renderLanding() {
  root.innerHTML = `
    <div class="site-wrap">
      <header class="site-header landing">
        <h1 class="site-title">Philip Di Fiore</h1>
        <span class="site-subtitle">director 路 filmmaker 路 photographer</span>
      </header>

      <main class="content landing">
        <div class="chat-section">
          <div class="chat-label">Artificial Phil</div>

          <div class="chat-area">
            <div class="chat-messages">
              ${chatMessages.map(msg => `
                <div class="msg ${msg.role}">${msg.content}</div>
              `).join('')}
              ${chatLoading ? `
                <div class="msg assistant"><div class="dots"><span></span><span></span><span></span></div></div>
              ` : ''}
            </div>
            <div class="chat-input-row">
              <input type="text" class="chat-input" placeholder="Ask me anything..." id="chatInput" />
              <button class="send-btn" id="sendBtn" ${chatLoading ? 'disabled' : ''}>Send</button>
            </div>
          </div>

          <div class="preset-chips">
            ${PRESET_QUESTIONS.map(q => `
              <button class="chip" data-question="${q.replace(/'/g, '&#39;')}" onclick="askPreset(this.dataset.question)">${q}</button>
            `).join('')}
          </div>

          <div style="text-align: center;">
            <button class="go-to-site-btn" onclick="navigateTo('projects')">Go to Site</button>
          </div>
        </div>
      </main>

      <footer class="site-footer landing">
        <div class="footer-contact">
          <a href="${CONTACT.instagram}" target="_blank">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
          </a>
          <a href="mailto:${CONTACT.email}">${CONTACT.email}</a>
        </div>
        <div class="footer-copyright">&copy; ${new Date().getFullYear()} Philip Di Fiore</div>
      </footer>
    </div>
  `;

  attachChatListeners();
}

function renderSite() {
  let content = '';

  switch (currentView) {
    case 'about':
      content = renderAbout();
      break;
    case 'apps':
      content = renderApps();
      break;
    case 'detail':
      content = renderDetail();
      break;
    case 'projects':
    default:
      content = renderProjects();
  }

  root.innerHTML = `
    <div class="site-wrap">
      <header class="site-header">
        <h1 class="site-title" onclick="navigateTo('landing')">Philip Di Fiore</h1>
        <span class="site-subtitle">director 路 filmmaker 路 photographer</span>
      </header>

      <nav class="tab-nav">
        <button class="tab-btn ${currentView === 'projects' || currentView === 'detail' ? 'active' : ''}" onclick="navigateTo('projects')">Projects</button>
        <button class="tab-btn ${currentView === 'about' ? 'active' : ''}" onclick="navigateTo('about')">About</button>
        <button class="tab-btn ${currentView === 'apps' ? 'active' : ''}" onclick="navigateTo('apps')">Apps</button>
      </nav>

      <main class="content">
        ${content}
      </main>

      <footer class="site-footer">
        <div class="footer-contact">
          <a href="${CONTACT.instagram}" target="_blank">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
          </a>
          <a href="mailto:${CONTACT.email}">${CONTACT.email}</a>
        </div>
        <div class="footer-copyright">&copy; ${new Date().getFullYear()} Philip Di Fiore</div>
      </footer>
    </div>

      `;

  // Attach event listeners
  if (currentView === 'projects') {
    attachProjectsListeners();
  }
}

function renderProjects() {
  if (projects.length === 0) {
    return `<div class="loading"><div class="dots"><span></span><span></span><span></span></div></div>`;
  }

  return `
    <div class="project-grid">
      ${projects.map(project => `
        <div class="project-card" data-project-id="${project.id}" data-image="${project.featured_image || ''}">
          <div class="project-title">${decodeHTML(project.title)}</div>
          <div class="project-subtitle">${project.category || ''}</div>
        </div>
      `).join('')}
    </div>
  `;
}

function renderAbout() {
  return `<div class="about-content">${ABOUT_TEXT}</div>`;
}

function renderApps() {
  return `
    <div class="apps-grid">
      ${APPS.map(app => `
        <a href="${app.url}" target="_blank" class="app-card">
          <div class="app-header">
            <div class="app-header-title">${app.title}</div>
          </div>
          <div class="app-card-content">
            <div class="app-desc">${app.desc}</div>
          </div>
        </a>
      `).join('')}
    </div>
  `;
}

function renderDetail() {
  if (!currentProject) return '<p>Project not found.</p>';

  return `
    <div class="detail-page">
      <div class="detail-back" onclick="navigateTo('projects')">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back
      </div>

      ${currentProject.vimeo_id ? `
        <div class="video-container">
          <iframe src="https://player.vimeo.com/video/${currentProject.vimeo_id}?title=0&byline=0&portrait=0" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
        </div>
      ` : currentProject.featured_image ? `
        <div class="detail-image">
          <img src="${currentProject.featured_image}" alt="${decodeHTML(currentProject.title)}" />
        </div>
      ` : ''}

      <h1 class="detail-title">${decodeHTML(currentProject.title)}</h1>
      ${currentProject.content ? `<div class="detail-caption">${currentProject.content}</div>` : ''}
    </div>
  `;
}

// ==================== EVENT LISTENERS ====================

function attachChatListeners() {
  const input = document.getElementById('chatInput');
  const sendBtn = document.getElementById('sendBtn');

  if (input && sendBtn) {
    sendBtn.addEventListener('click', () => {
      const msg = input.value.trim();
      if (msg && !chatLoading) {
        sendChatMessage(msg);
        input.value = '';
      }
    });

    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const msg = input.value.trim();
        if (msg && !chatLoading) {
          sendChatMessage(msg);
          input.value = '';
        }
      }
    });
  }

  // Scroll to bottom of chat
  const chatBox = document.querySelector('.chat-messages');
  if (chatBox) chatBox.scrollTop = chatBox.scrollHeight;

  // Apply mobile colors to preset chips
  applyMobileColors();
}

function attachProjectsListeners() {
  document.querySelectorAll('.project-card').forEach(card => {
    const projectId = parseInt(card.dataset.projectId);

    card.addEventListener('click', () => {
      currentProject = projects.find(p => p.id === projectId);
      currentView = 'detail';
      render();
      window.scrollTo(0, 0);
    });
  });

  // Apply mobile colors to project cards
  applyMobileColors();
}

// ==================== NAVIGATION ====================

function navigateTo(view) {
  currentView = view;
  currentProject = null;
  render();
  window.scrollTo(0, 0);
}

function askPreset(question) {
  if (!chatLoading) {
    sendChatMessage(question);
  }
}

window.navigateTo = navigateTo;
window.askPreset = askPreset;

// ==================== INITIALIZE ====================

async function init() {
  // Show landing page immediately
  render();

  // Load projects from Supabase in background
  try {
    projects = await fetchProjects();
  } catch (error) {
    console.error('Failed to load projects:', error);
  }
}

init();
</script>

</body>
</html>
