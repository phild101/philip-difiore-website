<!DOCTYPE html>
<html lang="en">
<head>
<!-- cache bust v2 -->
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Philip Di Fiore</title>
<link rel="stylesheet" href="https://use.typekit.net/ayz4ezz.css" />
<link rel="stylesheet" href="https://use.typekit.net/iof8yta.css" />
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
</head>
<body>
<div id="root"></div>

<style>
:root {
  --bg: #fff;
  --text: #000;
  --text-dim: #999;
  --border: #000;
  --font-display: 'itc-avant-garde-gothic-pro', 'Century Gothic', sans-serif;
  --font-body: 'DM Sans', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: #fff;
  color: #000;
  font-family: var(--font-body);
}

.site-wrap {
  min-height: 100vh;
  background: #fff;
  display: flex;
  flex-direction: column;
}

.site-wrap.landing-wrap {
  height: 100vh;
  max-height: 100vh;
  overflow: hidden;
}

/* Sticky Header Wrapper */
.sticky-header-wrap {
  position: sticky;
  top: 0;
  z-index: 100;
  background: #fff;
}

/* Header */
.site-header {
  padding: 4rem 3rem 1.5rem;
  text-align: center;
  background: #fff;
  border-bottom: 1px solid #000;
}

.site-header.landing {
  padding: 3rem 3rem 1rem;
  border-bottom: none;
  background: #fff;
}

.site-title {
  font-family: var(--font-display);
  font-size: 5.5rem;
  font-weight: 800;
  color: #000;
  letter-spacing: -0.06em;
  text-transform: uppercase;
  line-height: 0.9;
  display: block;
  cursor: pointer;
}

.site-subtitle {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  color: #999;
  text-transform: none;
  letter-spacing: 0.02em;
  margin-top: 0.375rem;
  display: block;
  font-style: italic;
}

/* Navigation Tabs */
.tab-nav {
  display: flex;
  justify-content: center;
  gap: 0;
  padding: 0;
  border-bottom: 1px solid #000;
  background: #fff;
}

.tab-btn {
  font-family: var(--font-body);
  font-size: 0.85rem;
  font-weight: 400;
  letter-spacing: 0;
  text-transform: none;
  padding: 1rem 2.5rem;
  border: none;
  border-right: 1px solid #000;
  background: #fff;
  color: #999;
  cursor: pointer;
  transition: all 0.15s;
}

.tab-btn:last-child { border-right: none; }

.tab-btn:hover { color: #000; }

.tab-btn.active {
  color: #000;
  font-weight: 600;
}

/* Content Area */
.content {
  max-width: 1100px;
  margin: 0 auto;
  padding: 1.5rem 3rem;
  flex: 1;
  width: 100%;
}

.content.landing {
  padding: 1rem 3rem 2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
  overflow: hidden;
}

/* AI Chat Section - Landing Page */
.chat-section {
  max-width: 800px;
  width: 100%;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
}

/* chat-label-prefix and chat-label styles are now inside .chat-landing-overlay */

.chat-area {
  background: #fff;
  border: 1px solid #000;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
}

/* Chat landing overlay */
.chat-landing-overlay {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  flex: 1;
  min-height: 0;
}

.chat-landing-overlay .chat-label-prefix {
  font-family: var(--font-body);
  font-size: 0.75rem;
  color: #fff;
  text-transform: none;
  letter-spacing: 0;
  margin-bottom: 0.5rem;
  text-align: center;
  display: block;
}

.chat-landing-overlay .chat-label {
  font-family: 'itc-avant-garde-gothic-pro', var(--font-display);
  font-size: 3.5rem;
  font-weight: bold;
  color: #fff;
  text-transform: uppercase;
  letter-spacing: -0.02em;
  margin-bottom: 0;
  text-align: center;
}

.chat-landing-overlay.hidden {
  display: none;
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 2rem;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  background: #fff;
}

.chat-messages.hidden {
  display: none;
}

.msg {
  max-width: 85%;
  padding: 0;
  font-size: 0.95rem;
  line-height: 1.7;
}

.msg.user {
  align-self: flex-end;
  background: none;
  color: #000;
  font-weight: 400;
  text-align: right;
  border-bottom: 2px solid #000;
  padding-bottom: 1rem;
}

.msg.assistant {
  align-self: flex-start;
  background: none;
  font-style: normal;
  color: #333;
  font-family: var(--font-body);
  font-size: 0.85rem;
  font-weight: 400;
}

.msg.assistant p {
  margin-bottom: 1em;
}

.msg.assistant p:last-child {
  margin-bottom: 0;
}

.chat-input-row {
  padding: 0;
  border-top: 1px solid #000;
  display: flex;
  gap: 0;
}

.chat-input {
  flex: 1;
  background: #fff;
  border: none;
  padding: 1.5rem 1.5rem;
  color: #000;
  font-family: var(--font-body);
  font-size: 1rem;
  outline: none;
}

.chat-input::placeholder { color: #ccc; }

.send-btn {
  background: #000;
  border: none;
  border-left: 1px solid #000;
  padding: 1.5rem 2.5rem;
  color: #fff;
  font-family: var(--font-body);
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
}
.send-btn:hover { background: #333; }
.send-btn:disabled { opacity: 0.3; cursor: not-allowed; }

/* Preset Question Chips - inside chat box (desktop) */
.preset-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  padding: 1rem 1.5rem;
  justify-content: flex-start;
  border-top: 1px solid #000;
  background: #fff;
}

/* Preset Question Chips - outside chat box (mobile only) */
.preset-chips-mobile {
  display: none;
  flex-wrap: wrap;
  gap: 0.5rem;
  padding: 1.5rem 0;
  justify-content: center;
}

.chip {
  background: #fff;
  border: 1px solid #000;
  padding: 0.5rem 1rem;
  font-size: 0.75rem;
  color: #666;
  cursor: pointer;
  transition: all 0.15s;
  font-family: var(--font-body);
  text-align: center;
}

/* Color sequence for hover (reverse): Red, Yellow, Blue, Green, Orange */
.chip:nth-child(5n+1):hover { background: #ff432e; color: #fff; }
.chip:nth-child(5n+2):hover { background: #f0ff00; color: #000; }
.chip:nth-child(5n+3):hover { background: #4abbff; color: #fff; }
.chip:nth-child(5n+4):hover { background: #1db406; color: #fff; }
.chip:nth-child(5n+5):hover { background: #ff8d00; color: #fff; }

/* Go to Site Button - inline with Send button */
.go-to-site-btn {
  background: #fff;
  color: #000;
  font-family: var(--font-body);
  font-size: 0.9rem;
  font-weight: 600;
  text-transform: none;
  letter-spacing: 0;
  text-decoration: none;
  border: none;
  border-left: 1px solid #000;
  padding: 1.5rem 2.5rem;
  cursor: pointer;
  transition: all 0.15s;
  text-align: center;
}

.go-to-site-btn:hover {
  background: #fff;
  color: #000;
}

/* Loading dots */
.dots {
  display: inline-flex;
  gap: 6px;
  align-items: center;
  padding: 0.5rem 0;
}

.dots span {
  width: 4px;
  height: 4px;
  background: #000;
  border-radius: 50%;
  animation: pulse 1.2s infinite;
}

.dots span:nth-child(2) { animation-delay: 0.2s; }
.dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes pulse {
  0%, 80%, 100% { opacity: 0.15; }
  40% { opacity: 1; }
}

/* Project Layout - Desktop: Left list + Center preview + Right list */
.project-layout {
  display: flex;
  gap: 0;
  border: 1px solid #000;
  height: calc(100vh - 220px);
  min-height: 400px;
  position: relative;
}

.project-list {
  width: 280px;
  flex-shrink: 0;
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: #ccc transparent;
  position: relative;
  z-index: 1;
  background: transparent;
}

.project-list::-webkit-scrollbar {
  width: 6px;
}

.project-list::-webkit-scrollbar-track {
  background: transparent;
}

.project-list::-webkit-scrollbar-thumb {
  background: #ccc;
  border-radius: 3px;
}

.project-list::-webkit-scrollbar-thumb:hover {
  background: #999;
}

.project-list-left {
  border-right: 1px solid #000;
}

.project-list-right {
  border-left: 1px solid #000;
}

.project-card {
  background: transparent;
  border-bottom: 1px solid #000;
  padding: 0.85rem 1rem;
  cursor: pointer;
  transition: all 0.15s;
  position: relative;
  text-decoration: none;
  color: inherit;
  display: block;
}

.project-card:last-child {
  border-bottom: none;
}

/* Color sequence for hover: Orange, Green, Blue, Yellow, Red */
.project-card:nth-child(5n+1):hover { background: #ff8d00; color: #fff; }
.project-card:nth-child(5n+2):hover { background: #1db406; color: #fff; }
.project-card:nth-child(5n+3):hover { background: #4abbff; color: #fff; }
.project-card:nth-child(5n+4):hover { background: #f0ff00; color: #000; }
.project-card:nth-child(5n+5):hover { background: #ff432e; color: #fff; }

.project-card:nth-child(5n+4):hover .project-subtitle { color: #666; }
.project-card:hover .project-subtitle { color: rgba(255,255,255,0.7); }
.project-card:nth-child(5n+4):hover .project-subtitle { color: rgba(0,0,0,0.5); }

.project-card .project-title {
  font-family: var(--font-display);
  font-size: 1rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: -0.02em;
  margin-bottom: 0.35rem;
  line-height: 1.1;
}

.project-card .project-subtitle {
  font-family: var(--font-body);
  font-size: 0.75rem;
  color: #999;
  letter-spacing: 0;
  font-weight: 400;
  font-style: italic;
}

/* When rollover image is showing, turn all project text white with subtle shadow */
.project-layout.image-active .project-card .project-title {
  color: #fff;
  text-shadow: 0 1px 3px rgba(0,0,0,0.4);
}

.project-layout.image-active .project-card .project-subtitle {
  color: rgba(255,255,255,0.7);
  text-shadow: 0 1px 3px rgba(0,0,0,0.4);
}

/* Large Image Preview Area */
.project-preview {
  flex: 1;
  display: block;
  background: transparent;
  padding: 0;
  position: static;
  overflow: hidden;
}

.project-preview-image {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  border: none;
  opacity: 0;
  transition: opacity 0.2s ease;
  z-index: 0;
  pointer-events: none;
}

.project-preview-image.visible {
  opacity: 1;
}

.project-preview-placeholder {
  font-family: var(--font-mono);
  font-size: 0.8rem;
  color: #ccc;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

/* Legacy hover image - hidden on desktop now */
.hover-image {
  display: none;
}

/* About Page */
.about-content {
  max-width: 700px;
  margin: 0 auto;
}

.about-content p {
  font-family: var(--font-body);
  font-size: 0.85rem;
  line-height: 1.7;
  margin-bottom: 1.5rem;
  color: #444;
}

/* Apps Page */
.apps-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 2rem;
}

.app-card {
  text-decoration: none;
  color: inherit;
  display: block;
}

/* Color sequence for app card hover: Red, Green, Yellow, Orange */
.app-card:nth-child(4n+1):hover .app-header { background: #ff432e; }
.app-card:nth-child(4n+2):hover .app-header { background: #1db406; }
.app-card:nth-child(4n+3):hover .app-header { background: #f0ff00; }
.app-card:nth-child(4n+4):hover .app-header { background: #ff8d00; }

.app-header {
  width: 100%;
  height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #fff;
  border: 1px solid #000;
  transition: background 0.15s;
}

.app-header-title {
  font-family: var(--font-display);
  font-size: 3.5rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: -0.04em;
  color: #000;
  text-align: center;
  padding: 1rem;
  line-height: 1;
  transition: color 0.15s;
}

.app-card:hover .app-header-title {
  color: #fff;
}

.app-card:nth-child(4n+3):hover .app-header-title {
  color: #000;
}

.app-header-has-image {
  height: auto;
  padding: 0;
  overflow: hidden;
  position: relative;
}

.app-header-has-image::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: transparent;
  transition: background 0.15s;
  pointer-events: none;
  mix-blend-mode: multiply;
}

.app-card:nth-child(4n+1):hover .app-header-has-image::after { background: #ff432e; }
.app-card:nth-child(4n+2):hover .app-header-has-image::after { background: #1db406; }
.app-card:nth-child(4n+3):hover .app-header-has-image::after { background: #f0ff00; }
.app-card:nth-child(4n+4):hover .app-header-has-image::after { background: #ff8d00; }

.app-header-img {
  width: 100%;
  height: auto;
  display: block;
  object-fit: contain;
  transition: filter 0.15s;
}

.app-card:hover .app-header-img {
  filter: invert(1);
}

.app-card-content {
  padding: 1rem 0 0 0;
}

.app-card .app-title {
  font-family: var(--font-display);
  font-size: 1.2rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: -0.02em;
  margin-bottom: 0.5rem;
}

.app-card .app-desc {
  font-size: 0.85rem;
  color: #666;
  line-height: 1.6;
}

/* Detail Page */
.detail-page {
  max-width: 900px;
  margin: 0 auto;
}

.detail-back {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-family: var(--font-body);
  font-size: 0.85rem;
  color: #999;
  text-decoration: none;
  margin-bottom: 2rem;
  cursor: pointer;
  transition: color 0.15s;
}

.detail-back:hover { color: #000; }

.video-container {
  position: relative;
  padding-bottom: 56.25%;
  height: 0;
  overflow: hidden;
  border: 1px solid #000;
  margin-bottom: 2rem;
}

.detail-image {
  margin-bottom: 2rem;
  border: 1px solid #000;
}

.detail-image img {
  width: 100%;
  height: auto;
  display: block;
}

.video-container iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.detail-title {
  font-family: var(--font-display);
  font-size: 2rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: -0.03em;
  margin-bottom: 1rem;
}

.detail-caption {
  font-family: var(--font-body);
  font-size: 0.85rem;
  line-height: 1.7;
  color: #444;
}

.detail-caption a { color: #000; }

/* Footer */
.site-footer {
  text-align: center;
  padding: 3rem;
  border-top: 1px solid #000;
  background: #fff;
}

.site-footer.landing {
  border-top: none;
  padding: 1rem 3rem;
  flex-shrink: 0;
}

.footer-contact {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 2rem;
  margin-bottom: 1.5rem;
}

.footer-contact a {
  color: #000;
  text-decoration: none;
  font-size: 0.9rem;
  transition: color 0.15s;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.footer-contact a:hover { color: #666; }

.footer-contact svg {
  width: 20px;
  height: 20px;
}

.footer-copyright {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  color: #999;
}

/* ==================== RESPONSIVE / MOBILE ==================== */

/* Tablet breakpoint (900px and below) */
@media (max-width: 900px) {
  /* Header */
  .site-header {
    padding: 3rem 2rem 2rem;
  }

  .site-header.landing {
    padding: 4rem 2rem 2rem;
  }

  .site-title {
    font-size: 4rem;
  }

  /* Projects Layout - stack vertically on tablet */
  .project-layout {
    flex-direction: column;
    height: auto;
    min-height: auto;
  }

  .project-list {
    width: 100%;
    border-right: none;
    max-height: none;
  }

  .project-preview {
    display: none;
  }

  /* Apps Grid - single column on tablet */
  .apps-grid {
    grid-template-columns: 1fr;
  }

  .app-card {
    border-right: none !important;
  }

  .app-header {
    height: 180px;
  }

  .app-header-has-image {
    height: auto;
  }

  .app-header-title {
    font-size: 2.5rem;
  }

  /* Content area */
  .content {
    padding: 3rem 2rem;
  }

  /* Chat area */
  .chat-area {
    min-height: 400px;
    max-height: 500px;
  }
}

/* Mobile breakpoint (600px and below) */
@media (max-width: 600px) {
  /* Header - Mobile */
  .site-header {
    padding: 2.5rem 1.25rem 1.5rem;
  }

  .site-header.landing {
    padding: 3rem 1.25rem 1.5rem;
  }

  .site-title {
    font-size: 2.2rem;
    letter-spacing: -0.04em;
  }

  .site-subtitle {
    font-size: 0.6rem;
    margin-top: 1rem;
  }

  /* Navigation - Mobile */
  .tab-nav {
    flex-wrap: nowrap;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .tab-nav::-webkit-scrollbar {
    display: none;
  }

  .tab-btn {
    padding: 0.85rem 1.5rem;
    font-size: 0.8rem;
    flex-shrink: 0;
    white-space: nowrap;
  }

  /* Content - Mobile */
  .content {
    padding: 1.5rem 1.25rem 2rem;
  }

  .content.landing {
    padding: 1rem 1.25rem 2rem;
  }

  /* Chat Section - Mobile */
  .chat-section {
    width: 100%;
  }

  .chat-landing-overlay .chat-label {
    font-size: 1.3rem;
    margin-bottom: 0;
  }

  .chat-area {
    min-height: 320px;
    max-height: 400px;
  }

  .chat-messages {
    padding: 1.25rem;
    gap: 1rem;
  }

  .msg {
    max-width: 95%;
    font-size: 0.9rem;
    line-height: 1.6;
  }

  .msg.user {
    padding-bottom: 0.75rem;
  }

  .msg.assistant {
    font-size: 0.82rem;
  }

  .chat-input-row {
    flex-direction: column;
  }

  .chat-input {
    padding: 1rem 1.25rem;
    font-size: 1rem; /* Prevents iOS zoom on focus */
    border-bottom: 1px solid #000;
  }

  .send-btn {
    padding: 1rem 1.5rem;
    border-left: none;
    font-size: 0.85rem;
  }

  /* Preset Chips - Mobile */
  .preset-chips {
    gap: 0.5rem;
    margin-top: 1.5rem;
    max-width: 100%;
  }

  .chip {
    padding: 0.6rem 0.9rem;
    font-size: 0.7rem;
  }

  /* Go to Site Button - Mobile (stacked under Send) */
  .go-to-site-btn {
    padding: 1rem 1.5rem;
    font-size: 0.85rem;
    border-left: none;
    border-top: 1px solid #000;
    width: 100%;
  }

  /* Mobile Landing - remove locked layout, allow scroll */
  .site-wrap.landing-wrap {
    height: auto;
    max-height: none;
    overflow: visible;
  }

  /* Mobile Landing - sticky header only */
  .site-header.landing {
    position: sticky;
    top: 0;
    z-index: 100;
  }

  /* Mobile - hide preset chips inside chat box */
  .chat-area .preset-chips {
    display: none;
  }

  /* Mobile - show preset chips outside chat box */
  .preset-chips-mobile {
    display: flex;
  }

  /* Projects - Single column on mobile (50% smaller cards) */
  .project-card {
    min-height: 50px;
    padding: 0.75rem 0.625rem;
  }

  .project-card .project-title {
    font-size: 0.75rem;
    margin-bottom: 0.25rem;
  }

  .project-card .project-subtitle {
    font-size: 0.6rem;
  }

  /* Detail Page - Mobile */
  .detail-page {
    max-width: 100%;
  }

  .detail-back {
    font-size: 0.8rem;
    margin-bottom: 1.5rem;
  }

  .detail-title {
    font-size: 1.3rem;
    margin-bottom: 0.75rem;
  }

  .detail-caption {
    font-size: 0.82rem;
    line-height: 1.65;
  }

  .video-container {
    margin-bottom: 1.5rem;
  }

  /* About Page - Mobile */
  .about-content {
    max-width: 100%;
  }

  .about-content p {
    font-size: 0.82rem;
    line-height: 1.65;
    margin-bottom: 1.25rem;
  }

  /* Apps Page - Mobile */
  .apps-grid {
    gap: 1.5rem;
  }

  .app-header {
    height: 140px;
  }

  .app-header-has-image {
    height: auto;
  }

  .app-header-title {
    font-size: 2rem;
    padding: 0.75rem;
  }

  .app-card-content {
    padding: 0.75rem 0 0 0;
  }

  .app-card .app-desc {
    font-size: 0.8rem;
  }

  /* Footer - Mobile */
  .site-footer {
    padding: 2rem 1.25rem;
  }

  .site-footer.landing {
    padding-top: 1.5rem;
  }

  .footer-contact {
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1.25rem;
  }

  .footer-contact a {
    font-size: 0.85rem;
  }

  .footer-copyright {
    font-size: 0.65rem;
  }

  /* Hide hover image on mobile */
  .hover-image {
    display: none;
  }
}

/* Small mobile breakpoint (380px and below) */
@media (max-width: 380px) {
  .site-title {
    font-size: 1.8rem;
  }

  .chat-landing-overlay .chat-label {
    font-size: 1.1rem;
  }

  .chip {
    padding: 0.5rem 0.7rem;
    font-size: 0.65rem;
  }

  .tab-btn {
    padding: 0.75rem 1rem;
    font-size: 0.75rem;
  }

  .app-header-title {
    font-size: 1.6rem;
  }
}

/* Touch device fixes - disable hover effects, use persistent colors on mobile */
@media (hover: none) {
  /* Disable hover colors on project cards on mobile */
  .project-card:hover {
    background: inherit;
    color: inherit;
  }

  .project-card:hover .project-subtitle {
    color: inherit;
  }

  /* Disable tap delay for instant response */
  .project-card {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* Active/tap state - fill with full color (uses .tapped class via JS for better control) */
  .project-card.mobile-color-orange.tapped { background: #ff8d00; color: #fff; }
  .project-card.mobile-color-orange.tapped .project-subtitle { color: rgba(255,255,255,0.7); }

  .project-card.mobile-color-green.tapped { background: #1db406; color: #fff; }
  .project-card.mobile-color-green.tapped .project-subtitle { color: rgba(255,255,255,0.7); }

  .project-card.mobile-color-blue.tapped { background: #4abbff; color: #fff; }
  .project-card.mobile-color-blue.tapped .project-subtitle { color: rgba(255,255,255,0.7); }

  .project-card.mobile-color-yellow.tapped { background: #f0ff00; color: #000; }
  .project-card.mobile-color-yellow.tapped .project-subtitle { color: rgba(0,0,0,0.5); }

  .project-card.mobile-color-red.tapped { background: #ff432e; color: #fff; }
  .project-card.mobile-color-red.tapped .project-subtitle { color: rgba(255,255,255,0.7); }

  /* Chips - disable hover on touch devices, start white, fill with color on tap */
  .chip:hover {
    background: inherit;
    color: inherit;
  }

  /* Disable tap delay for instant response */
  .chip {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* Tapped state - fill with color (managed via JS, stays lit until another chip is tapped) */
  .chip.mobile-color-orange.tapped { background: #ff8d00; color: #fff; border-color: #ff8d00; }
  .chip.mobile-color-green.tapped { background: #1db406; color: #fff; border-color: #1db406; }
  .chip.mobile-color-blue.tapped { background: #4abbff; color: #fff; border-color: #4abbff; }
  .chip.mobile-color-yellow.tapped { background: #f0ff00; color: #000; border-color: #f0ff00; }
  .chip.mobile-color-red.tapped { background: #ff432e; color: #fff; border-color: #ff432e; }

  /* App cards - disable hover on touch devices, start white, fill with color on tap */
  .app-card:hover .app-header {
    background: inherit;
  }

  .app-card:hover .app-header-title {
    color: inherit;
  }

  .app-card:hover .app-header-img {
    filter: none;
  }

  .app-card:hover .app-header-has-image::after {
    background: transparent;
  }

  /* Disable tap delay for instant response */
  .app-card {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* Tapped state - fill with color (managed via JS, stays lit until another app card is tapped) */
  .app-card.mobile-color-red.tapped .app-header { background: #ff432e; }
  .app-card.mobile-color-red.tapped .app-header-title { color: #fff; }

  .app-card.mobile-color-green.tapped .app-header { background: #1db406; }
  .app-card.mobile-color-green.tapped .app-header-title { color: #fff; }

  .app-card.mobile-color-blue.tapped .app-header { background: #f0ff00; }
  .app-card.mobile-color-blue.tapped .app-header-title { color: #000; }

  .app-card.mobile-color-orange.tapped .app-header { background: #ff8d00; }
  .app-card.mobile-color-orange.tapped .app-header-title { color: #fff; }

  .app-card.tapped .app-header-img { filter: invert(1); }
  .app-card.mobile-color-red.tapped .app-header-has-image::after { background: #ff432e; }
  .app-card.mobile-color-green.tapped .app-header-has-image::after { background: #1db406; }
  .app-card.mobile-color-blue.tapped .app-header-has-image::after { background: #f0ff00; }
  .app-card.mobile-color-orange.tapped .app-header-has-image::after { background: #ff8d00; }

  /* Buttons */
  .go-to-site-btn:hover {
    background: #000;
    color: #fff;
  }

  .go-to-site-btn:active {
    background: #fff;
    color: #000;
  }

  .send-btn:hover {
    background: #000;
  }

  .send-btn:active {
    background: #333;
  }

  /* Hide hover image */
  .hover-image {
    display: none;
  }
}

/* iOS Safari specific fixes */
@supports (-webkit-touch-callout: none) {
  /* Prevent iOS zoom on input focus */
  .chat-input {
    font-size: 16px;
  }

  /* Fix for iOS momentum scrolling */
  .chat-messages {
    -webkit-overflow-scrolling: touch;
  }

  /* Fix for safe area (notch) */
  .site-wrap {
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }

  .site-footer {
    padding-bottom: calc(2rem + env(safe-area-inset-bottom));
  }

  @media (max-width: 600px) {
    .site-footer {
      padding-bottom: calc(1.5rem + env(safe-area-inset-bottom));
    }
  }
}

/* Landscape mobile orientation */
@media (max-width: 900px) and (orientation: landscape) {
  .site-header {
    padding: 1.5rem 2rem 1rem;
  }

  .site-header.landing {
    padding: 2rem 2rem 1rem;
  }

  .chat-area {
    min-height: 250px;
    max-height: 300px;
  }

  .go-to-site-btn {
    margin-top: 1.5rem;
  }
}
</style>

<script>
// ==================== CONFIGURATION ====================

const SUPABASE_URL = 'https://gjvvbofpkxuicrpshxun.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqdnZib2Zwa3h1aWNycHNoeHVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNzY1NzcsImV4cCI6MjA4NTc1MjU3N30.igGl_64MuqL-0VsLE4NibmMq1hPxnZ_WusRrM043n5M';
const EDGE_FUNCTION_URL = `${SUPABASE_URL}/functions/v1/artificial-philip`;

// Preset questions for the chat
const PRESET_QUESTIONS = [
  "Tell me about yourself",
  "Tell me about your films",
  "Who are your influences?",
  "What interests you?",
  "You make apps too?",
  "What's your creative process?"
];

// Apps data
const APPS = [
  {
    id: 'wolves',
    title: 'Wolves in the Piano',
    desc: 'Chat with 94 creative masters about their process. Features AI conversations with artists, writers, and filmmakers.',
    image: 'https://images.unsplash.com/photo-1507838153414-b4b713384a76?w=600&h=400&fit=crop',
    headerImage: 'https://gjvvbofpkxuicrpshxun.supabase.co/storage/v1/object/public/project-images/wolvesimage.png',
    url: 'https://wolvesinthepiano.com'
  },
  {
    id: 'ideamachine',
    title: 'The Idea Machine',
    desc: 'Capture ideas and build them into reality. A tool for developing creative concepts.',
    image: 'https://images.unsplash.com/photo-1455849318743-b2233052fcff?w=600&h=400&fit=crop',
    headerImage: 'https://gjvvbofpkxuicrpshxun.supabase.co/storage/v1/object/public/project-images/theideamachine-illustration.jpg',
    url: 'https://ideamachineapp.com'
  },
  {
    id: 'plotter',
    title: 'Plotter',
    desc: 'Your story builder. A tool designed to assist in creating narratives and stories.',
    image: 'https://images.unsplash.com/photo-1456324504439-367cee3b3c32?w=600&h=400&fit=crop',
    headerImage: 'https://gjvvbofpkxuicrpshxun.supabase.co/storage/v1/object/public/project-images/plotterimage2-inverted.png',
    url: 'https://goplotter.com'
  },
  {
    id: 'superzero',
    title: 'Super Zero',
    desc: 'Smart note-taking with natural language parsing, kanban boards, and calendar integration.',
    image: 'https://images.unsplash.com/photo-1484480974693-6ca0a78fb36b?w=600&h=400&fit=crop',
    headerImage: 'https://gjvvbofpkxuicrpshxun.supabase.co/storage/v1/object/public/project-images/zeroimage.png',
    url: 'https://superzeroapp.com'
  }
];

// About content
const ABOUT_TEXT = `
<p>Philip Di Fiore is an award-winning filmmaker known for his cinematic approach to storytelling. He writes, directs and edits most all of his projects.</p>
<p>Di Fiore's music videos have been described as thrilling, cinematic and beyond the cutting edge. His mind bending narrative videos for <a href="#" onclick="goToProject(3); return false;"><em>In the City</em></a> and <a href="#" onclick="goToProject(4); return false;"><em>Old Friend</em></a> were described as "Lynchian" with "a Twilight Zone aura of spine-tingling weirdness". His Sharon Jones and The Dap-Kings music videos were likened to treasures of 1970's street cinema- blaxplotiation classic <em>Across 110th Street</em> and Martin Scorsese's <em>Mean Streets</em>.</p>
<p>The New York Times hailed his film <a href="#" onclick="goToProject(1); return false;"><em>The Buffalo Hunt</em></a> as "a striking, poetic look at the Lakota Sioux." The film garnered best documentary and best director awards on the film festival circuit. <a href="#" onclick="goToProject(2); return false;"><em>Stranger: Bernie Worrell on Earth</em></a>, a film about the keyboard/synth genius of Parliament Funkadelic & Talking Heads featured David Byrne, George Clinton, Mos Def and Bootsy Collins. <em>Stranger</em> premiered at the Slamdance Film Festival and the original 35mm print was selected to become part of the The Academy of Motion Picture Arts and Sciences permanent collection.</p>
<p>Di Fiore has directed projects for vanguard record labels DFA, Daptone, Fat Possum, Atlantic and Island Records. He also has been commissioned to produce and direct original live music series for Ralph Lauren Denim & Supply, JetBlue, Spotify, and Brooklyn Bowl. His work has premiered on Vevo, Pitchfork, Noisey, The Fader, IFC, Stereogum, Rolling Stone, Funny or Die, VH1, and MTV, RAI (Italy), and Arte (France/Germany).</p>
<p>In 2010, Di Fiore founded <a href="#" onclick="goToProject(9); return false;"><em>The Rumpus Room</em></a> in Brooklyn, NY- a 4000 square foot recording and film studio. <em>The Rumpus Room</em> served as a creative production hub and gathering place for musicians, filmmakers, actors and animators from NYC and around the world. It was an essential part of the Brooklyn's creative ecosystem for nearly a decade.</p>
<p>Di Fiore is currently working on feature length films and has recently created a suite of <a href="#" onclick="navigateTo('apps'); return false;">creative apps</a>.</p>
`;

// Contact info
const CONTACT = {
  email: 'phil@philipdifiore.com',
  instagram: 'https://instagram.com/philipdifiore'
};

// ==================== STATE ====================

let projects = [];
let currentView = 'landing'; // 'landing', 'projects', 'about', 'apps', 'detail'
let currentProject = null;
let chatMessages = [];
let chatLoading = false;

const root = document.getElementById('root');

// ==================== API FUNCTIONS ====================

async function fetchProjects() {
  const res = await fetch(`${SUPABASE_URL}/rest/v1/projects?select=*&hidden=neq.true&order=display_order.asc,created_at.desc`, {
    headers: {
      'apikey': SUPABASE_ANON_KEY,
      'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
    }
  });
  return res.json();
}

async function sendChatMessage(userMessage) {
  // Clear previous messages and start fresh each time
  chatMessages = [{ role: 'user', content: userMessage }];
  chatLoading = true;
  render();

  try {
    const response = await fetch(EDGE_FUNCTION_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ messages: chatMessages })
    });

    const data = await response.json();

    if (data.error) {
      throw new Error(data.error);
    }

    // Start typewriter effect
    chatLoading = false;
    chatMessages = [{ role: 'assistant', content: '', typing: true }];
    render();

    await typewriterEffect(data.response);

  } catch (error) {
    console.error('Chat error:', error);
    chatLoading = false;
    chatMessages = [{
      role: 'assistant',
      content: "Sorry, I'm having trouble connecting right now. Please try again in a moment."
    }];
    render();
  }
}

async function typewriterEffect(fullText) {
  // Convert paragraph breaks to HTML - split on double newlines or after sentences that end a thought
  const formattedText = fullText
    .replace(/\n\n/g, '</p><p>')  // Double newlines become paragraph breaks
    .replace(/\n/g, '<br>')        // Single newlines become line breaks
    .replace(/^/, '<p>')           // Start with paragraph
    .replace(/$/, '</p>');         // End with paragraph

  const chars = formattedText.split('');
  let currentText = '';
  const speed = 15; // milliseconds per character

  for (let i = 0; i < chars.length; i++) {
    currentText += chars[i];
    chatMessages = [{ role: 'assistant', content: currentText, typing: i < chars.length - 1 }];

    // Update just the message content without full re-render for performance
    const msgElement = document.querySelector('.chat-messages .msg.assistant');
    if (msgElement) {
      msgElement.innerHTML = currentText;
    }

    // Skip delay for HTML tags
    if (chars[i] === '<') {
      // Fast-forward through the tag
      while (i < chars.length - 1 && chars[i] !== '>') {
        i++;
        currentText += chars[i];
      }
      if (msgElement) {
        msgElement.innerHTML = currentText;
      }
    } else {
      await new Promise(resolve => setTimeout(resolve, speed));
    }
  }

  // Final render to ensure state is synced
  chatMessages = [{ role: 'assistant', content: formattedText, typing: false }];
}

// ==================== HELPER FUNCTIONS ====================

function decodeHTML(html) {
  const txt = document.createElement('textarea');
  txt.innerHTML = html;
  return txt.value;
}

// Mobile color helpers
// Project cards: Orange, Green, Blue, Yellow, Red (matches desktop hover pattern)
const PROJECT_COLORS = ['orange', 'green', 'blue', 'yellow', 'red'];
// Chips: Red, Yellow, Blue, Green, Orange (reverse pattern, matches desktop hover)
const CHIP_COLORS = ['red', 'yellow', 'blue', 'green', 'orange'];
// App cards: Red, Green, Blue, Orange (matches desktop hover pattern)
const APP_COLORS = ['red', 'green', 'blue', 'orange'];

function isTouchDevice() {
  return window.matchMedia('(hover: none)').matches;
}

function applyMobileColors() {
  if (!isTouchDevice()) return;

  // Apply colors to project cards (fill on tap)
  document.querySelectorAll('.project-card').forEach((card, index) => {
    const color = PROJECT_COLORS[index % 5];
    card.classList.add(`mobile-color-${color}`);
  });

  // Note: Chips are handled separately in attachChatListeners() with touch handlers
  // They start white and fill with color only when tapped

  // Note: App cards are handled separately in attachAppsListeners() with touch handlers
  // They start white and fill with color only when tapped
}

// ==================== RENDER FUNCTIONS ====================

function render() {
  if (currentView === 'landing') {
    renderLanding();
  } else {
    renderSite();
  }
}

function renderLanding() {
  root.innerHTML = `
    <div class="site-wrap landing-wrap">
      <header class="site-header landing">
        <h1 class="site-title">Philip Di Fiore</h1>
      </header>

      <main class="content landing">
        <div class="chat-section">
          <div class="chat-area">
            <div class="chat-landing-overlay ${chatMessages.length > 0 ? 'hidden' : ''}">
              <span class="chat-label-prefix">chat with</span>
              <div class="chat-label">A.I. Phil</div>
            </div>
            <div class="chat-messages ${chatMessages.length === 0 ? 'hidden' : ''}">
              ${chatMessages.map(msg => `
                <div class="msg ${msg.role}">${msg.content}</div>
              `).join('')}
              ${chatLoading ? `
                <div class="msg assistant"><div class="dots"><span></span><span></span><span></span></div></div>
              ` : ''}
            </div>
            <div class="preset-chips">
              ${PRESET_QUESTIONS.map(q => `
                <button class="chip" data-question="${q.replace(/'/g, '&#39;')}" onclick="askPreset(this.dataset.question)">${q}</button>
              `).join('')}
            </div>
            <div class="chat-input-row">
              <input type="text" class="chat-input" placeholder="Ask me anything..." id="chatInput" />
              <button class="send-btn" id="sendBtn" ${chatLoading ? 'disabled' : ''}>Send</button>
              <button class="go-to-site-btn" id="goToSiteBtn" onclick="navigateTo('projects')">Go to Site</button>
            </div>
          </div>

          <!-- Preset chips outside chat box for mobile -->
          <div class="preset-chips-mobile">
            ${PRESET_QUESTIONS.map(q => `
              <button class="chip" data-question="${q.replace(/'/g, '&#39;')}" onclick="askPreset(this.dataset.question)">${q}</button>
            `).join('')}
          </div>
        </div>
      </main>

      <footer class="site-footer landing">
        <div class="footer-contact">
          <a href="${CONTACT.instagram}" target="_blank">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
          </a>
          <a href="mailto:${CONTACT.email}">${CONTACT.email}</a>
        </div>
        <div class="footer-copyright">&copy; ${new Date().getFullYear()} Philip Di Fiore</div>
      </footer>
    </div>
  `;

  // Apply random color to chat landing overlay
  const overlay = document.querySelector('.chat-landing-overlay');
  if (overlay) overlay.style.backgroundColor = chatOverlayColor;

  attachChatListeners();
}

function renderSite() {
  let content = '';

  switch (currentView) {
    case 'about':
      content = renderAbout();
      break;
    case 'apps':
      content = renderApps();
      break;
    case 'detail':
      content = renderDetail();
      break;
    case 'projects':
    default:
      content = renderProjects();
  }

  root.innerHTML = `
    <div class="site-wrap">
      <div class="sticky-header-wrap">
        <header class="site-header">
          <h1 class="site-title" onclick="navigateTo('landing')">Philip Di Fiore</h1>
        </header>

        <nav class="tab-nav">
          <button class="tab-btn ${currentView === 'projects' || currentView === 'detail' ? 'active' : ''}" onclick="navigateTo('projects')">Projects</button>
          <button class="tab-btn ${currentView === 'about' ? 'active' : ''}" onclick="navigateTo('about')">About</button>
          <button class="tab-btn ${currentView === 'apps' ? 'active' : ''}" onclick="navigateTo('apps')">Apps</button>
        </nav>
      </div>

      <main class="content">
        ${content}
      </main>

      <footer class="site-footer">
        <div class="footer-contact">
          <a href="${CONTACT.instagram}" target="_blank">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
          </a>
          <a href="mailto:${CONTACT.email}">${CONTACT.email}</a>
        </div>
        <div class="footer-copyright">&copy; ${new Date().getFullYear()} Philip Di Fiore</div>
      </footer>
    </div>

      `;

  // Attach event listeners
  if (currentView === 'projects') {
    attachProjectsListeners();
  }

  // Apply mobile colors and listeners for apps page
  if (currentView === 'apps') {
    attachAppsListeners();
  }
}

function renderProjects() {
  if (projects.length === 0) {
    return `<div class="loading"><div class="dots"><span></span><span></span><span></span></div></div>`;
  }

  // Split projects in half
  const half = Math.ceil(projects.length / 2);
  const leftProjects = projects.slice(0, half);
  const rightProjects = projects.slice(half);

  return `
    <div class="project-layout">
      <div class="project-list project-list-left">
        ${leftProjects.map(project => `
          <div class="project-card" data-project-id="${project.id}" data-image="${project.featured_image || ''}">
            <div class="project-title">${decodeHTML(project.title)}</div>
            <div class="project-subtitle">${project.category || ''}</div>
          </div>
        `).join('')}
      </div>
      <div class="project-preview">
        <img class="project-preview-image" src="" alt="" />
      </div>
      <div class="project-list project-list-right">
        ${rightProjects.map(project => `
          <div class="project-card" data-project-id="${project.id}" data-image="${project.featured_image || ''}">
            <div class="project-title">${decodeHTML(project.title)}</div>
            <div class="project-subtitle">${project.category || ''}</div>
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

function renderAbout() {
  return `<div class="about-content">${ABOUT_TEXT}</div>`;
}

function renderApps() {
  return `
    <div class="apps-grid">
      ${APPS.map(app => `
        <a href="${app.url}" target="_blank" class="app-card">
          <div class="app-header${app.headerImage ? ' app-header-has-image' : ''}">
            ${app.headerImage
              ? `<img src="${app.headerImage}" alt="${app.title}" class="app-header-img">`
              : `<div class="app-header-title">${app.title}</div>`
            }
          </div>
          <div class="app-card-content">
            <div class="app-title">${app.title}</div>
            <div class="app-desc">${app.desc}</div>
          </div>
        </a>
      `).join('')}
    </div>
  `;
}

function renderDetail() {
  if (!currentProject) return '<p>Project not found.</p>';

  return `
    <div class="detail-page">
      <div class="detail-back" onclick="navigateTo('projects')">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back
      </div>

      ${currentProject.vimeo_id ? `
        <div class="video-container">
          <iframe src="https://player.vimeo.com/video/${currentProject.vimeo_id}?title=0&byline=0&portrait=0" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
        </div>
      ` : currentProject.featured_image ? `
        <div class="detail-image">
          <img src="${currentProject.featured_image}" alt="${decodeHTML(currentProject.title)}" />
        </div>
      ` : ''}

      <h1 class="detail-title">${decodeHTML(currentProject.title)}</h1>
      ${currentProject.content ? `<div class="detail-caption">${currentProject.content}</div>` : ''}
    </div>
  `;
}

// ==================== EVENT LISTENERS ====================

function attachChatListeners() {
  const input = document.getElementById('chatInput');
  const sendBtn = document.getElementById('sendBtn');

  if (input && sendBtn) {
    sendBtn.addEventListener('click', () => {
      const msg = input.value.trim();
      if (msg && !chatLoading) {
        sendChatMessage(msg);
        input.value = '';
      }
    });

    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const msg = input.value.trim();
        if (msg && !chatLoading) {
          sendChatMessage(msg);
          input.value = '';
        }
      }
    });
  }

  // Scroll to bottom of chat
  const chatBox = document.querySelector('.chat-messages');
  if (chatBox) chatBox.scrollTop = chatBox.scrollHeight;

  // Randomize hover color for Go to Site button
  const goToSiteBtn = document.getElementById('goToSiteBtn');
  if (goToSiteBtn) {
    const colors = [
      { bg: '#ff8d00', text: '#fff' },  // orange
      { bg: '#1db406', text: '#fff' },  // green
      { bg: '#4abbff', text: '#fff' },  // blue
      { bg: '#f0ff00', text: '#000' },  // yellow
      { bg: '#ff432e', text: '#fff' }   // red
    ];

    goToSiteBtn.addEventListener('mouseenter', () => {
      const randomColor = colors[Math.floor(Math.random() * colors.length)];
      goToSiteBtn.style.backgroundColor = randomColor.bg;
      goToSiteBtn.style.color = randomColor.text;
    });

    goToSiteBtn.addEventListener('mouseleave', () => {
      goToSiteBtn.style.backgroundColor = '#fff';
      goToSiteBtn.style.color = '#000';
    });
  }

  // Apply mobile color classes to chips (but not tapped - they start white)
  const allChips = document.querySelectorAll('.chip');
  if (isTouchDevice()) {
    allChips.forEach((chip, index) => {
      const color = CHIP_COLORS[index % 5];
      chip.classList.add(`mobile-color-${color}`);

      // Touch handlers for color feedback - chip stays lit until another is tapped
      chip.addEventListener('touchstart', (e) => {
        // Remove tapped class from all chips first
        allChips.forEach(c => c.classList.remove('tapped'));
        // Add tapped class to this chip
        chip.classList.add('tapped');
      }, { passive: true });
    });
  }

  // Apply mobile colors to other elements (app cards, project cards)
  applyMobileColors();
}

function attachProjectsListeners() {
  const allCards = document.querySelectorAll('.project-card');
  const previewImage = document.querySelector('.project-preview-image');
  const previewPlaceholder = document.querySelector('.project-preview-placeholder');

  allCards.forEach(card => {
    const projectId = parseInt(card.dataset.projectId);
    const imageUrl = card.dataset.image;

    // Click handler for navigation
    card.addEventListener('click', () => {
      currentProject = projects.find(p => p.id === projectId);
      currentView = 'detail';
      render();
      window.scrollTo(0, 0);
    });

    // Desktop: hover to show image in preview area
    if (!isTouchDevice() && previewImage) {
      const layout = document.querySelector('.project-layout');
      card.addEventListener('mouseenter', () => {
        if (imageUrl) {
          previewImage.src = imageUrl;
          previewImage.alt = card.querySelector('.project-title').textContent;
          previewImage.classList.add('visible');
          if (layout) layout.classList.add('image-active');
          if (previewPlaceholder) previewPlaceholder.style.display = 'none';
        }
      });

      card.addEventListener('mouseleave', () => {
        previewImage.classList.remove('visible');
        if (layout) layout.classList.remove('image-active');
        if (previewPlaceholder) previewPlaceholder.style.display = 'block';
      });
    }

    // Touch handlers for color feedback on mobile
    if (isTouchDevice()) {
      card.addEventListener('touchstart', (e) => {
        // Remove tapped class from all cards first
        allCards.forEach(c => c.classList.remove('tapped'));
        // Add tapped class to this card
        card.classList.add('tapped');
      }, { passive: true });

      card.addEventListener('touchend', () => {
        // Keep tapped briefly for visual feedback before navigation
        setTimeout(() => {
          card.classList.remove('tapped');
        }, 150);
      }, { passive: true });

      card.addEventListener('touchcancel', () => {
        card.classList.remove('tapped');
      }, { passive: true });
    }
  });

  // Apply mobile colors to project cards
  applyMobileColors();
}

function attachAppsListeners() {
  const allAppCards = document.querySelectorAll('.app-card');

  if (isTouchDevice()) {
    allAppCards.forEach((card, index) => {
      // Add mobile color class
      const color = APP_COLORS[index % 4];
      card.classList.add(`mobile-color-${color}`);

      // Touch handlers for color feedback - card stays lit until another is tapped
      card.addEventListener('touchstart', (e) => {
        // Remove tapped class from all app cards first
        allAppCards.forEach(c => c.classList.remove('tapped'));
        // Add tapped class to this card
        card.classList.add('tapped');
      }, { passive: true });
    });
  }
}

// ==================== NAVIGATION ====================

function navigateTo(view) {
  currentView = view;
  currentProject = null;
  render();
  window.scrollTo(0, 0);
}

function askPreset(question) {
  if (!chatLoading) {
    sendChatMessage(question);
  }
}

function goToProject(projectId) {
  currentProject = projects.find(p => p.id === projectId);
  if (currentProject) {
    currentView = 'detail';
    render();
    window.scrollTo(0, 0);
  }
}

window.navigateTo = navigateTo;
window.askPreset = askPreset;
window.goToProject = goToProject;

// ==================== INITIALIZE ====================

// Random chat overlay color (excluding yellow)
const CHAT_COLORS = ['#ff432e', '#ff8d00', '#1db406', '#4abbff'];
const chatOverlayColor = CHAT_COLORS[Math.floor(Math.random() * CHAT_COLORS.length)];

async function init() {
  // Show landing page immediately
  render();

  // Load projects from Supabase in background
  try {
    projects = await fetchProjects();
  } catch (error) {
    console.error('Failed to load projects:', error);
  }
}

init();
</script>

</body>
</html>
