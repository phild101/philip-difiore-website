<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Philip Di Fiore</title>
<link rel="stylesheet" href="https://use.typekit.net/ayz4ezz.css" />
<link rel="stylesheet" href="https://use.typekit.net/iof8yta.css" />
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
</head>
<body>
<div id="root"></div>

<style>
/* ==================== RESET & BASE ==================== */
:root {
  --bg: #0a0a0a;
  --text: #f3f3f3;
  --text-dim: rgba(243, 243, 243, 0.5);
  --border: rgba(255, 255, 255, 0.12);
  --grid-line: #ffffff;
  --font-display: 'itc-avant-garde-gothic-pro', 'Century Gothic', sans-serif;
  --font-body: 'DM Sans', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
  --cell-width: 400px;
  --cell-height: 500px;
  --grid-gap: 5px;
  --cols: 5;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-body);
  overflow: hidden;
  width: 100%;
  height: 100%;
  cursor: grab;
}

body:active {
  cursor: grabbing;
}

::selection {
  background: #ff432e;
  color: #fff;
}

/* ==================== LOADING SCREEN ==================== */
.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  transition: opacity 0.6s ease, visibility 0.6s ease;
}

.loading-screen.fade-out {
  opacity: 0;
  visibility: hidden;
}

.loading-title {
  font-family: var(--font-display);
  font-size: 2.4rem;
  font-weight: 700;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--text);
  margin-bottom: 2rem;
}

.loading-bar-track {
  width: 200px;
  height: 2px;
  background: rgba(255, 255, 255, 0.15);
  position: relative;
  overflow: hidden;
}

.loading-bar-fill {
  height: 100%;
  background: #fff;
  width: 0%;
  transition: width 0.15s ease;
}

.loading-count {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  letter-spacing: 0.1em;
  color: var(--text-dim);
  margin-top: 1rem;
}

/* ==================== CRT OVERLAY (Romei's exact system) ==================== */
.crt-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9999;
  opacity: 0.17;
  animation: crt-scan 8s linear infinite;
}

/* 1. Scanlines — horizontal lines */
.crt-overlay::before {
  content: '';
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  background: linear-gradient(
    to bottom,
    rgba(18, 16, 16, 0) 50%,
    rgba(0, 0, 0, 0.25) 50%
  );
  background-size: 100% 4px;
  z-index: 2;
  pointer-events: none;
}

/* 2. Vignette + Flicker */
.crt-overlay::after {
  content: '';
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  background: radial-gradient(
    circle,
    rgba(0, 0, 0, 0) 50%,
    rgba(0, 0, 0, 0.4) 100%
  );
  z-index: 2;
  pointer-events: none;
  animation: flicker 0.15s infinite;
}

/* Subtle flicker */
@keyframes flicker {
  0% { opacity: 0.95; }
  50% { opacity: 0.92; }
  100% { opacity: 0.96; }
}

/* Slow scan pulse */
@keyframes crt-scan {
  0% { background-color: rgba(255, 255, 255, 0); }
  50% { background-color: rgba(255, 255, 255, 0.02); }
  100% { background-color: rgba(255, 255, 255, 0); }
}

/* ==================== TOP HEADER BAR ==================== */
.top-bar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 20px 24px;
  pointer-events: none;
  background: rgba(10, 10, 10, 0.4);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}

.top-bar > * {
  pointer-events: auto;
}

.top-bar-left {
  display: flex;
  gap: 48px;
}

.top-bar-section {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.top-bar-label {
  font-family: var(--font-body);
  font-size: 10px;
  font-weight: 500;
  text-transform: uppercase;
  color: var(--text);
  letter-spacing: 0.02em;
  line-height: 1.4;
}

.top-bar-label a {
  color: var(--text);
  text-decoration: none;
  transition: opacity 0.3s;
}

.top-bar-label a:hover {
  opacity: 0.6;
}

.top-bar-heading {
  font-family: var(--font-body);
  font-size: 10px;
  font-weight: 500;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 6px;
  letter-spacing: 0.02em;
}

.top-bar-bio {
  font-family: var(--font-body);
  font-size: 10px;
  font-weight: 500;
  text-transform: uppercase;
  color: var(--text);
  max-width: 480px;
  line-height: 1.4;
  letter-spacing: 0.02em;
}

/* ==================== NAV BUTTONS ==================== */
.nav-buttons {
  display: flex;
  flex-direction: column;
  gap: 8px;
  pointer-events: auto;
}

.nav-btn {
  position: relative;
  font-family: var(--font-body);
  font-size: 10px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  color: var(--text);
  background: none;
  border: none;
  padding: 8px 16px;
  cursor: pointer;
  transition: all 0.35s ease;
  text-decoration: none;
  text-align: center;
  border-radius: 2rem;
  isolation: isolate;
  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.25);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.nav-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  z-index: 0;
  border-radius: 2rem;
  background-color: rgba(255, 255, 255, 0.12);
  box-shadow:
    inset 0 1px 1px rgba(255, 255, 255, 0.6),
    inset 0 -1px 1px rgba(0, 0, 0, 0.15),
    inset 0 0 12px 2px rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.35);
  pointer-events: none;
}

.nav-btn::after {
  content: '';
  position: absolute;
  inset: 0;
  z-index: -1;
  border-radius: 2rem;
  backdrop-filter: blur(16px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter: blur(16px) saturate(180%) brightness(1.1);
  filter: url(#glass-distortion);
  -webkit-filter: url("#glass-distortion");
  pointer-events: none;
}

.nav-btn:hover {
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.35);
}

/* ==================== BOTTOM BAR ==================== */
.bottom-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  padding: 20px 24px;
  pointer-events: none;
  background: rgba(10, 10, 10, 0.4);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}

.bottom-bar > * {
  pointer-events: auto;
}

.bottom-title {
  font-family: var(--font-display);
  font-size: 4.5rem;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: -0.06em;
  color: var(--text);
  line-height: 0.85;
  cursor: pointer;
  transition: opacity 0.3s;
}

.bottom-title:hover {
  opacity: 0.7;
}

.bottom-hint {
  font-family: var(--font-body);
  font-size: 10px;
  font-weight: 500;
  text-transform: uppercase;
  color: var(--text-dim);
  text-align: right;
  line-height: 1.5;
}

/* ==================== THE ARTBOARD GRID ==================== */
.artboard {
  position: fixed;
  top: 0;
  left: 0;
}

/* Each column is an absolutely-positioned vertical strip */
.artboard-column {
  position: absolute;
  top: 0;
  left: 0;
  width: var(--cell-width);
  will-change: transform;
}

.artboard-cell {
  position: relative;
  width: var(--cell-width);
  height: var(--cell-height);
  overflow: hidden;
  cursor: pointer;
  background: #111;
  border: 2px solid var(--grid-line);
}

/* Background image layer — replaces <img> for instant cached rendering */
.cell-bg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  /* Kodak Tri-X 400 film look */
  filter: grayscale(100%) contrast(1.0) brightness(0.92) sepia(35%) blur(0.3px);
  transition: filter 0.5s cubic-bezier(0.25, 0.1, 0.25, 1), transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
}

/* Hover: flip to full color + subtle zoom */
.artboard-cell:hover .cell-bg {
  filter: grayscale(0%) contrast(1.05) brightness(1.05) saturate(1.1);
  transform: scale(1.04);
}

/* App images — inverted for dark aesthetic (Plotter excluded — already dark) */
.artboard-cell[data-type="app"]:not([data-id="plotter"]) .cell-bg {
  filter: grayscale(100%) contrast(1.0) brightness(0.92) sepia(35%) blur(0.3px) invert(1);
}

.artboard-cell[data-type="app"]:not([data-id="plotter"]):hover .cell-bg {
  filter: grayscale(0%) contrast(1.05) brightness(1.05) saturate(1.1) invert(1);
  transform: scale(1.04);
}

/* Per-project override: Sinkane "Runnin'" (id:17) */
.artboard-cell[data-id="17"] .cell-bg {
  filter: grayscale(100%) contrast(0.7) brightness(1.3) sepia(35%) blur(0.3px);
}
.artboard-cell[data-id="17"]:hover .cell-bg {
  filter: grayscale(0%) contrast(1.05) brightness(1.05) saturate(1.1);
}

/* Grain overlay on each cell */
.artboard-cell::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 2;
  pointer-events: none;
  opacity: 0.12;
  mix-blend-mode: overlay;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-size: 128px 128px;
}

/* Bottom gradient for text readability */
.artboard-cell::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    180deg,
    transparent 0%,
    transparent 70%,
    rgba(0, 0, 0, 0.35) 100%
  );
  z-index: 1;
  pointer-events: none;
  transition: opacity 0.4s;
}

.artboard-cell:hover::after {
  opacity: 0.3;
}


.cell-info {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 16px;
  z-index: 2;
  transform: translateY(4px);
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
}

.artboard-cell:hover .cell-info {
  transform: translateY(0);
  opacity: 1;
}

.cell-title {
  font-family: var(--font-display);
  font-size: 14px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: -0.01em;
  color: #fff;
  line-height: 1.2;
  margin-bottom: 4px;
  text-shadow: 0 1px 4px rgba(0,0,0,0.5);
}

.cell-category {
  font-family: var(--font-body);
  font-size: 10px;
  font-weight: 400;
  color: rgba(255,255,255,0.65);
  text-transform: uppercase;
  letter-spacing: 0.03em;
  text-shadow: 0 1px 3px rgba(0,0,0,0.5);
}

/* ==================== DETAIL VIEW ==================== */
.detail-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg);
  z-index: 5000;
  overflow-y: auto;
  display: none;
}

.detail-overlay.visible {
  display: block;
}

.detail-inner {
  max-width: 900px;
  margin: 0 auto;
  padding: 80px 40px 60px;
}

.detail-back {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-family: var(--font-body);
  font-size: 10px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  color: var(--text-dim);
  cursor: pointer;
  margin-bottom: 40px;
  transition: color 0.3s;
  background: none;
  border: none;
  padding: 0;
}

.detail-back:hover {
  color: var(--text);
}

.detail-back svg {
  width: 14px;
  height: 14px;
}

.video-container {
  position: relative;
  padding-bottom: 56.25%;
  height: 0;
  overflow: hidden;
  margin-bottom: 32px;
  border: 1px solid var(--border);
}

.video-container iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.detail-image {
  margin-bottom: 32px;
  border: 1px solid var(--border);
}

.detail-image img {
  width: 100%;
  height: auto;
  display: block;
  filter: grayscale(100%) contrast(1.15) brightness(0.85);
}

.detail-title {
  font-family: var(--font-display);
  font-size: 2rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: -0.03em;
  color: var(--text);
  margin-bottom: 16px;
}

.detail-caption {
  font-family: var(--font-body);
  font-size: 0.85rem;
  line-height: 1.7;
  color: var(--text-dim);
}

.detail-caption a {
  color: var(--text);
}

/* ==================== ABOUT OVERLAY ==================== */
.about-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg);
  z-index: 5000;
  overflow-y: auto;
  display: none;
}

.about-overlay.visible {
  display: block;
}

.about-inner {
  max-width: 700px;
  margin: 0 auto;
  padding: 80px 40px 60px;
}

.about-inner .detail-back {
  margin-bottom: 40px;
}

.about-title {
  font-family: var(--font-display);
  font-size: 2.5rem;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: -0.04em;
  color: var(--text);
  margin-bottom: 32px;
}

.about-content p {
  font-family: var(--font-body);
  font-size: 0.85rem;
  line-height: 1.8;
  color: rgba(243, 243, 243, 0.7);
  margin-bottom: 1.5rem;
}

.about-content a {
  color: var(--text);
}

/* ==================== RUMPUS AI OVERLAY ==================== */
.rumpus-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg);
  z-index: 5000;
  overflow-y: auto;
  display: none;
}

.rumpus-overlay.visible {
  display: block;
}

.rumpus-inner {
  max-width: 900px;
  margin: 0 auto;
  padding: 80px 40px 60px;
}

.rumpus-inner .detail-back {
  margin-bottom: 40px;
}

.rumpus-title {
  font-family: var(--font-display);
  font-size: 2.5rem;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: -0.04em;
  color: var(--text);
  margin-bottom: 12px;
}

.rumpus-subtitle {
  font-family: var(--font-body);
  font-size: 0.8rem;
  line-height: 1.6;
  color: var(--text-dim);
  margin-bottom: 48px;
  max-width: 500px;
}

.rumpus-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 40px;
}

.rumpus-card {
  display: flex;
  flex-direction: column;
  text-decoration: none;
  transition: all 0.4s ease;
}

.rumpus-card:hover {
  transform: translateY(-3px);
}

.rumpus-card-img {
  position: relative;
  aspect-ratio: 4 / 3;
  border-radius: 6px;
  overflow: hidden;
  border: 1px solid var(--border);
  transition: border-color 0.4s ease, box-shadow 0.4s ease;
}

.rumpus-card:hover .rumpus-card-img {
  border-color: rgba(255, 255, 255, 0.3);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
}

.rumpus-card-bg {
  position: absolute;
  inset: 0;
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
  filter: grayscale(100%) contrast(1.0) brightness(0.92) sepia(35%) blur(0.3px);
  transition: filter 0.5s ease;
}

.rumpus-card:hover .rumpus-card-bg {
  filter: grayscale(100%) contrast(1.0) brightness(0.92) sepia(35%) blur(0.3px) invert(1);
}

.rumpus-card-info {
  padding: 16px 4px 0;
}

.rumpus-card-title {
  font-family: var(--font-display);
  font-size: 1.1rem;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: -0.02em;
  color: var(--text);
  margin-bottom: 6px;
}

.rumpus-card-desc {
  font-family: var(--font-body);
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.02em;
  color: var(--text-dim);
  line-height: 1.5;
}

@media (max-width: 600px) {
  .rumpus-grid {
    grid-template-columns: 1fr;
    gap: 32px;
  }
  .rumpus-title {
    font-size: 1.8rem;
  }
}

/* ==================== CHAT OVERLAY ==================== */
.chat-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.3);
  z-index: 5000;
  display: none;
  justify-content: center;
  align-items: center;
}

.chat-overlay.visible {
  display: flex;
}

.chat-inner {
  position: relative;
  width: 90%;
  max-width: 600px;
  max-height: 70vh;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 16px;
  padding: 32px 32px 24px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  isolation: isolate;
  box-shadow:
    0 24px 80px rgba(0, 0, 0, 0.5),
    inset 0 1px 1px rgba(255, 255, 255, 0.5),
    inset 0 -1px 1px rgba(0, 0, 0, 0.15),
    inset 0 0 12px 2px rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(24px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter: blur(24px) saturate(180%) brightness(1.1);
}

.chat-inner .detail-back {
  margin-bottom: 24px;
}

.chat-header-label {
  font-family: var(--font-body);
  font-size: 10px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.04em;
  margin-bottom: 8px;
}

.chat-header-title {
  font-family: var(--font-display);
  font-size: 1.5rem;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: -0.04em;
  color: var(--text);
  margin-bottom: 20px;
}

.chat-area-dark {
  border: 1px solid var(--border);
  border-radius: 8px;
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
  overflow: hidden;
}

.chat-messages-dark {
  flex: 1;
  overflow-y: auto;
  padding: 24px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.chat-messages-dark .msg {
  max-width: 85%;
  font-size: 0.85rem;
  line-height: 1.7;
  padding: 0;
}

.chat-messages-dark .msg.user {
  align-self: flex-end;
  color: var(--text);
  text-align: right;
  border-bottom: 1px solid var(--border);
  padding-bottom: 12px;
}

.chat-messages-dark .msg.assistant {
  align-self: flex-start;
  color: rgba(243,243,243,0.7);
}

.chat-messages-dark .msg.assistant p {
  margin-bottom: 1em;
}

.chat-messages-dark .msg.assistant p:last-child {
  margin-bottom: 0;
}

.chat-preset-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 16px 24px;
  border-top: 1px solid var(--border);
}

.chat-chip {
  background: transparent;
  border: 1px solid var(--border);
  padding: 8px 14px;
  font-size: 11px;
  font-family: var(--font-body);
  color: var(--text-dim);
  cursor: pointer;
  transition: all 0.3s;
}

.chat-chip:hover {
  border-color: var(--text);
  color: var(--text);
}

.chat-input-row-dark {
  display: flex;
  border-top: 1px solid var(--border);
}

.chat-input-dark {
  flex: 1;
  background: transparent;
  border: none;
  padding: 18px 24px;
  color: var(--text);
  font-family: var(--font-body);
  font-size: 0.9rem;
  outline: none;
}

.chat-input-dark::placeholder {
  color: rgba(243,243,243,0.25);
}

.chat-send-btn {
  background: var(--text);
  border: none;
  padding: 18px 28px;
  color: var(--bg);
  font-family: var(--font-body);
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  cursor: pointer;
  transition: opacity 0.3s;
}

.chat-send-btn:hover {
  opacity: 0.8;
}

.chat-send-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

/* Loading dots */
.dots {
  display: inline-flex;
  gap: 6px;
  align-items: center;
  padding: 4px 0;
}

.dots span {
  width: 4px;
  height: 4px;
  background: var(--text);
  border-radius: 50%;
  animation: pulse 1.2s infinite;
}

.dots span:nth-child(2) { animation-delay: 0.2s; }
.dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes pulse {
  0%, 80%, 100% { opacity: 0.15; }
  40% { opacity: 1; }
}

/* ==================== RESPONSIVE ==================== */
@media (max-width: 900px) {
  :root {
    --cell-width: 280px;
    --cell-height: 350px;
    --cols: 4;
  }

  .top-bar {
    padding: 14px 16px;
  }

  .top-bar-left {
    gap: 24px;
  }

  .top-bar-bio {
    display: none;
  }

  .bottom-title {
    font-size: 2.5rem;
  }

  .detail-inner,
  .about-inner,
  .chat-inner {
    padding: 60px 20px 40px;
  }
}

@media (max-width: 600px) {
  :root {
    --cell-width: 200px;
    --cell-height: 260px;
    --cols: 3;
  }

  .top-bar-left {
    gap: 16px;
  }

  .top-bar-section:not(:first-child) {
    display: none;
  }

  .bottom-title {
    font-size: 1.8rem;
  }

  .bottom-hint {
    display: none;
  }

  .nav-btn {
    font-size: 9px;
    padding: 6px 12px;
  }

  .cell-info {
    padding: 10px;
    opacity: 1;
    transform: translateY(0);
  }

  .cell-title {
    font-size: 11px;
  }

  .cell-category {
    font-size: 9px;
  }

  .detail-inner,
  .about-inner,
  .chat-inner {
    padding: 50px 16px 30px;
  }

  .detail-title {
    font-size: 1.4rem;
  }

  .about-title {
    font-size: 1.6rem;
  }

  .chat-header-title {
    font-size: 1.6rem;
  }

  .chat-input-row-dark {
    flex-direction: column;
  }

  .chat-send-btn {
    border-top: 1px solid var(--border);
  }
}

/* Touch device fixes */
@media (hover: none) {
  body {
    cursor: default;
  }

  body:active {
    cursor: default;
  }

  .cell-info {
    opacity: 1;
    transform: translateY(0);
  }
}

/* iOS safe areas */
@supports (-webkit-touch-callout: none) {
  .top-bar {
    padding-top: calc(20px + env(safe-area-inset-top));
  }

  .bottom-bar {
    padding-bottom: calc(20px + env(safe-area-inset-bottom));
  }
}
</style>

<script>
// ==================== CONFIGURATION ====================

const SUPABASE_URL = 'https://gjvvbofpkxuicrpshxun.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqdnZib2Zwa3h1aWNycHNoeHVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNzY1NzcsImV4cCI6MjA4NTc1MjU3N30.igGl_64MuqL-0VsLE4NibmMq1hPxnZ_WusRrM043n5M';
const EDGE_FUNCTION_URL = `${SUPABASE_URL}/functions/v1/artificial-philip`;

const PRESET_QUESTIONS = [
  "Tell me about yourself",
  "Tell me about your films",
  "Who are your influences?",
  "What interests you?",
  "You make apps too?",
  "What's your creative process?"
];

const APPS = [
  {
    id: 'wolves',
    title: 'Wolves in the Piano',
    desc: 'Chat with 94 creative masters about their process.',
    category: 'App',
    headerImage: 'https://gjvvbofpkxuicrpshxun.supabase.co/storage/v1/object/public/project-images/wolvesimage.png',
    url: 'https://wolvesinthepiano.com'
  },
  {
    id: 'ideamachine',
    title: 'The Idea Machine',
    desc: 'Capture ideas and build them into reality.',
    category: 'App',
    headerImage: 'https://gjvvbofpkxuicrpshxun.supabase.co/storage/v1/object/public/project-images/theideamachine-illustration.jpg',
    url: 'https://ideamachineapp.com'
  },
  {
    id: 'plotter',
    title: 'Plotter',
    desc: 'Your story builder for narratives and screenplays.',
    category: 'App',
    headerImage: 'https://gjvvbofpkxuicrpshxun.supabase.co/storage/v1/object/public/project-images/PlotterImagemaze.webp',
    url: 'https://goplotter.com'
  },
  {
    id: 'superzero',
    title: 'Super Zero',
    desc: 'Smart note-taking with natural language parsing.',
    category: 'App',
    headerImage: 'https://gjvvbofpkxuicrpshxun.supabase.co/storage/v1/object/public/project-images/zeroimage.png',
    url: 'https://superzeroapp.com'
  }
];

const ABOUT_TEXT = `
<p>Philip Di Fiore is an award-winning filmmaker (writer/director/editor) known for his cinematic approach to storytelling.</p>
<p>Di Fiore's music videos have been described as thrilling, cinematic and beyond the cutting edge. His mind bending videos for <a href="#" onclick="openProjectById(3);return false"><em>In the City</em></a> and <a href="#" onclick="openProjectById(4);return false"><em>Old Friend</em></a> were described as "Lynchian" with "a Twilight Zone aura of spine-tingling weirdness". His Sharon Jones and The Dap-Kings music videos were likened to treasures of 1970's street cinema- blaxplotiation classic <em>Across 110th Street</em> and Martin Scorsese's <em>Mean Streets</em>.</p>
<p>The New York Times hailed his film <a href="#" onclick="openProjectById(1);return false"><em>The Buffalo Hunt</em></a> as "a striking, poetic look at the Lakota Sioux." His film, <a href="#" onclick="openProjectById(2);return false"><em>Stranger: Bernie Worrell on Earth</em></a>, about the mad keyboard/synth genius of Parliament Funkadelic & Talking Heads featured David Byrne, George Clinton, Mos Def and Bootsy Collins. The 35mm film print of <em>Stranger</em> was selected by The Academy of Motion Picture Arts and Sciences for inclusion in its permanent collection.</p>
<p>In 2008, Di Fiore founded <a href="#" onclick="openProjectById(9);return false"><em>The Rumpus Room</em></a> in Brooklyn, NY- a 4000 square foot recording and film studio. <em>The Rumpus Room</em> served as a stomping ground for musicians, filmmakers, actors and artists from NYC and around the world. It was an essential part of the Brooklyn creative community for over a decade.</p>
<p>In 2026, Di Fiore founded <em>Rumpus AI</em>, an AI production studio to further his mission to employ all tools at available for the creation of cinematic stories. For <em>Rumpus AI</em>, Di Fiore has built a suite of AI apps geared to the storytelling and creative community.</p>
`;

const CONTACT = {
  email: 'phil@rumpusproductions.com',
  instagram: 'https://instagram.com/philipdifiore'
};

// ==================== STATE ====================

let projects = [];
let currentView = 'artboard'; // 'artboard', 'detail', 'about', 'chat'
let currentProject = null;
let chatMessages = [];
let chatLoading = false;

// Artboard physics state
let boardX = 0;
let boardY = 0;
let targetX = 0;
let targetY = 0;
let velocityX = 0;
let velocityY = 0;
let isDragging = false;
let dragStartX = 0;
let dragStartY = 0;
let dragStartBoardX = 0;
let dragStartBoardY = 0;
let lastDragX = 0;
let lastDragY = 0;
let lastDragTime = 0;
let animationId = null;

const root = document.getElementById('root');

// ==================== API FUNCTIONS ====================

async function fetchProjects() {
  const res = await fetch(`${SUPABASE_URL}/rest/v1/projects?select=*&hidden=neq.true&order=display_order.asc,created_at.desc`, {
    headers: {
      'apikey': SUPABASE_ANON_KEY,
      'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
    }
  });
  return res.json();
}

async function sendChatMessage(userMessage) {
  chatMessages = [{ role: 'user', content: userMessage }];
  chatLoading = true;
  renderChat();

  try {
    const response = await fetch(EDGE_FUNCTION_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ messages: chatMessages })
    });

    const data = await response.json();
    if (data.error) throw new Error(data.error);

    chatLoading = false;
    chatMessages = [{ role: 'assistant', content: '', typing: true }];
    renderChat();
    await typewriterEffect(data.response);
  } catch (error) {
    console.error('Chat error:', error);
    chatLoading = false;
    chatMessages = [{ role: 'assistant', content: "Sorry, I'm having trouble connecting right now. Please try again." }];
    renderChat();
  }
}

async function typewriterEffect(fullText) {
  const formattedText = fullText
    .replace(/\n\n/g, '</p><p>')
    .replace(/\n/g, '<br>')
    .replace(/^/, '<p>')
    .replace(/$/, '</p>');

  const chars = formattedText.split('');
  let currentText = '';
  const speed = 15;

  for (let i = 0; i < chars.length; i++) {
    currentText += chars[i];
    const msgElement = document.querySelector('.chat-messages-dark .msg.assistant');
    if (msgElement) msgElement.innerHTML = currentText;

    if (chars[i] === '<') {
      while (i < chars.length - 1 && chars[i] !== '>') {
        i++;
        currentText += chars[i];
      }
      if (msgElement) msgElement.innerHTML = currentText;
    } else {
      await new Promise(resolve => setTimeout(resolve, speed));
    }
  }

  chatMessages = [{ role: 'assistant', content: formattedText, typing: false }];
}

function decodeHTML(html) {
  const txt = document.createElement('textarea');
  txt.innerHTML = html;
  return txt.value;
}

// ==================== ARTBOARD PHYSICS ====================
// Based on Nicola Romei's exact scroll/drag/lerp system

function initArtboard() {
  const artboard = document.querySelector('.artboard');
  if (!artboard) return;

  const columns = artboard.querySelectorAll('.artboard-column');
  if (columns.length === 0) return;

  // Calculate dimensions
  const style = getComputedStyle(document.documentElement);
  const cellW = parseInt(style.getPropertyValue('--cell-width'));
  const cellH = parseInt(style.getPropertyValue('--cell-height'));
  const numCols = parseInt(style.getPropertyValue('--cols'));

  // Column height = number of cells in one column × cell height
  const cellsPerColumn = columns[0].querySelectorAll('.artboard-cell').length;
  const cellsPerRepeat = Math.round(cellsPerColumn / 2);
  const columnHeight = cellsPerRepeat * cellH; // Height of one repeat section
  const totalColumnWidth = numCols * cellW; // Width of one full set of columns

  // Build column data structure
  // Each logical column (0–4) has 3 X-repeat copies (-1, 0, 1)
  // Per-column Y speed multiplier (Romei formula): column 0 = fastest, column 4 = slowest
  const colData = [];
  columns.forEach(col => {
    const colIdx = parseInt(col.dataset.col);
    const xRepeat = parseInt(col.dataset.xrepeat);
    // Romei-inspired: my = 1 - (colIdx / (numCols - 1)) * 0.35
    // Column 0: 1.0, Column 1: 0.9125, Column 2: 0.825, Column 3: 0.7375, Column 4: 0.65
    const yMultiplier = 1.0 - (colIdx / (numCols - 1)) * 0.35;
    colData.push({
      el: col,
      colIdx,
      xRepeat,
      yMultiplier,
      baseX: (colIdx + xRepeat * numCols) * cellW
    });
  });

  // Romei system: tx/ty = target position, cx/cy = current (lerped) position
  let tx = (window.innerWidth - totalColumnWidth) / 2;
  let ty = (window.innerHeight - columnHeight) / 2;
  let cx = tx;
  let cy = ty;
  let onX = 0;
  let onY = 0;

  // Per-column current Y positions (each column lerps independently for its speed)
  const colCurrentY = new Array(numCols).fill(cy);
  const colTargetY = new Array(numCols).fill(ty);

  // Stride for wrapping
  const strideX = totalColumnWidth;
  const strideY = columnHeight;

  // Platform detection for scroll multipliers
  const isWindows = navigator.platform.indexOf('Win') > -1;
  const isFirefox = navigator.userAgent.indexOf('Firefox') > -1;
  const mouseMultiplier = isWindows ? 1.6 : 0.9;
  const firefoxMultiplier = isWindows ? 50 : 28;

  // ---- Wheel / Trackpad ----
  window.addEventListener('wheel', (e) => {
    if (currentView !== 'artboard') return;
    e.preventDefault();

    let dx = e.deltaX;
    let dy = e.deltaY;

    if (isFirefox) {
      dx *= firefoxMultiplier;
      dy *= firefoxMultiplier;
    } else {
      dx *= mouseMultiplier;
      dy *= mouseMultiplier;
    }

    tx -= dx;
    // Apply dy to each column with its multiplier
    for (let c = 0; c < numCols; c++) {
      const mult = 1.0 - (c / (numCols - 1)) * 0.35;
      colTargetY[c] -= dy * mult;
    }
  }, { passive: false });

  // ---- Mouse Drag (Romei's exact 2.5 multiplier) ----
  let dragLastY = 0;
  let dragLastX = 0;

  window.addEventListener('mousedown', (e) => {
    if (currentView !== 'artboard') return;
    if (e.target.closest('.top-bar') || e.target.closest('.bottom-bar') || e.target.closest('.nav-buttons')) return;

    isDragging = true;
    onX = tx - e.clientX * 2.5;
    dragLastX = e.clientX;
    dragLastY = e.clientY;
  });

  window.addEventListener('mousemove', (e) => {
    if (!isDragging || currentView !== 'artboard') return;
    tx = onX + e.clientX * 2.5;

    // Per-column Y drag with multiplier
    const dy = (e.clientY - dragLastY) * 2.5;
    for (let c = 0; c < numCols; c++) {
      const mult = 1.0 - (c / (numCols - 1)) * 0.35;
      colTargetY[c] -= dy * mult;
    }
    dragLastY = e.clientY;
  });

  window.addEventListener('mouseup', () => {
    if (!isDragging) return;
    isDragging = false;
  });

  // ---- Touch Events (same 2.5 multiplier) ----
  window.addEventListener('touchstart', (e) => {
    if (currentView !== 'artboard') return;
    if (e.target.closest('.top-bar') || e.target.closest('.bottom-bar') || e.target.closest('.nav-buttons')) return;

    isDragging = true;
    onX = tx - e.touches[0].clientX * 2.5;
    dragLastY = e.touches[0].clientY;
  }, { passive: true });

  window.addEventListener('touchmove', (e) => {
    if (!isDragging || currentView !== 'artboard') return;
    e.preventDefault();
    tx = onX + e.touches[0].clientX * 2.5;

    const dy = (e.touches[0].clientY - dragLastY) * 2.5;
    for (let c = 0; c < numCols; c++) {
      const mult = 1.0 - (c / (numCols - 1)) * 0.35;
      colTargetY[c] -= dy * mult;
    }
    dragLastY = e.touches[0].clientY;
  }, { passive: false });

  window.addEventListener('touchend', () => {
    isDragging = false;
  }, { passive: true });

  // ---- Click Detection (separate from drag) ----
  let clickStartX = 0;
  let clickStartY = 0;
  artboard.addEventListener('mousedown', (e) => {
    clickStartX = e.clientX;
    clickStartY = e.clientY;
  });

  artboard.addEventListener('mouseup', (e) => {
    const dx = Math.abs(e.clientX - clickStartX);
    const dy = Math.abs(e.clientY - clickStartY);
    if (dx < 5 && dy < 5) {
      const cell = e.target.closest('.artboard-cell');
      if (cell) handleCellClick(cell);
    }
  });

  // Touch click detection
  let touchClickX = 0;
  let touchClickY = 0;
  artboard.addEventListener('touchstart', (e) => {
    touchClickX = e.touches[0].clientX;
    touchClickY = e.touches[0].clientY;
  }, { passive: true });

  artboard.addEventListener('touchend', (e) => {
    const t = e.changedTouches[0];
    const dx = Math.abs(t.clientX - touchClickX);
    const dy = Math.abs(t.clientY - touchClickY);
    if (dx < 10 && dy < 10) {
      const cell = document.elementFromPoint(t.clientX, t.clientY);
      const cellEl = cell ? cell.closest('.artboard-cell') : null;
      if (cellEl) handleCellClick(cellEl);
    }
  }, { passive: true });

  // ---- Animation Loop ----
  function tick() {
    if (currentView !== 'artboard') {
      requestAnimationFrame(tick);
      return;
    }

    // Lerp X: same for all columns (uniform horizontal movement)
    cx += (tx - cx) * 0.085;
    cx = Math.round(cx * 100) / 100;

    // Lerp Y: per-column (each column has its own speed)
    for (let c = 0; c < numCols; c++) {
      colCurrentY[c] += (colTargetY[c] - colCurrentY[c]) * 0.085;
      colCurrentY[c] = Math.round(colCurrentY[c] * 100) / 100;
    }

    // ---- Infinite X wrap ----
    if (cx > strideX * 0.5) {
      cx -= strideX; tx -= strideX;
    } else if (cx < -strideX * 1.5) {
      cx += strideX; tx += strideX;
    }

    // ---- Infinite Y wrap: per-column (2 vertical repeats) ----
    for (let c = 0; c < numCols; c++) {
      if (colCurrentY[c] > 0) {
        colCurrentY[c] -= strideY;
        colTargetY[c] -= strideY;
      } else if (colCurrentY[c] < -strideY) {
        colCurrentY[c] += strideY;
        colTargetY[c] += strideY;
      }
    }

    // Position each column
    colData.forEach(({ el, colIdx, xRepeat, baseX }) => {
      const colX = Math.round((cx + baseX) * 100) / 100;
      const colY = Math.round(colCurrentY[colIdx] * 100) / 100;
      el.style.transform = `translate3d(${colX}px, ${colY}px, 0)`;
    });

    requestAnimationFrame(tick);
  }

  tick();
}

function handleCellClick(cell) {
  const type = cell.dataset.type;
  const id = cell.dataset.id;

  if (type === 'project') {
    const project = projects.find(p => p.id === parseInt(id));
    if (project) {
      currentProject = project;
      showDetail();
    }
  } else if (type === 'app') {
    const app = APPS.find(a => a.id === id);
    if (app && app.url) {
      window.open(app.url, '_blank');
    }
  }
}

// ==================== VIEW MANAGEMENT ====================

function showDetail() {
  currentView = 'detail';
  const overlay = document.querySelector('.detail-overlay');
  if (!overlay) return;

  const p = currentProject;
  overlay.querySelector('.detail-inner').innerHTML = `
    <button class="detail-back" onclick="closeOverlay()">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Back to Cinema Board
    </button>

    ${p.vimeo_id ? `
      <div class="video-container">
        <iframe src="https://player.vimeo.com/video/${p.vimeo_id}?title=0&byline=0&portrait=0" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
      </div>
    ` : p.featured_image ? `
      <div class="detail-image">
        <img src="${p.featured_image}" alt="${decodeHTML(p.title)}" />
      </div>
    ` : ''}

    <h1 class="detail-title">${decodeHTML(p.title)}</h1>
    ${p.content ? `<div class="detail-caption">${p.content}</div>` : ''}
  `;

  overlay.classList.add('visible');
}

function showAbout() {
  currentView = 'about';
  document.querySelector('.about-overlay').classList.add('visible');
}

function showRumpusAI() {
  currentView = 'rumpus';
  document.querySelector('.rumpus-overlay').classList.add('visible');
}

function showChat() {
  currentView = 'chat';
  chatMessages = [];
  chatLoading = false;
  document.querySelector('.chat-overlay').classList.add('visible');
  renderChat();
}

function closeOverlay() {
  currentView = 'artboard';
  document.querySelectorAll('.detail-overlay, .about-overlay, .chat-overlay, .rumpus-overlay').forEach(el => {
    el.classList.remove('visible');
  });
  // Clear video iframes to stop playback
  document.querySelectorAll('.detail-overlay iframe').forEach(iframe => {
    iframe.src = '';
  });
}

function openProjectById(id) {
  const project = projects.find(p => p.id === id);
  if (project) {
    document.querySelectorAll('.about-overlay, .chat-overlay, .rumpus-overlay').forEach(el => {
      el.classList.remove('visible');
    });
    currentProject = project;
    showDetail();
  }
}

// ==================== RENDER ====================

function renderArtboard() {
  // Combine projects and apps into grid items
  const allItems = [];

  projects.forEach(p => {
    allItems.push({
      type: 'project',
      id: p.id,
      title: decodeHTML(p.title),
      category: p.category,
      image: p.featured_image
    });
  });

  // Apps removed from artboard grid (now on Rumpus A.I. page)
  // APPS.forEach(a => {
  //   allItems.push({
  //     type: 'app',
  //     id: a.id,
  //     title: a.title,
  //     category: a.category || 'App',
  //     image: a.headerImage
  //   });
  // });

  const cols = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cols')) || 5;

  // Build cell HTML — uses background-image (not <img>) for instant cached rendering
  const makeCellHTML = (item) => `
    <div class="artboard-cell" data-type="${item.type}" data-id="${item.id}">
      ${item.image ? `<div class="cell-bg" style="background-image:url('${item.image}')"></div>` : ''}
      <div class="cell-info">
        <div class="cell-title">${item.title}</div>
        <div class="cell-category">${item.category}</div>
      </div>
    </div>
  `;

  // Seeded PRNG (deterministic shuffle)
  function makeRng(seed) {
    let s = seed;
    return function() { s = (s * 16807 + 0) % 2147483647; return (s - 1) / 2147483646; };
  }

  function shuffleArray(arr, rng) {
    const a = [...arr];
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(rng() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  // Grid placement strategy: build a 2D grid (cols × rows) where no item
  // appears within a rectangular neighborhood of itself. Specifically, for
  // any cell at (col, row), the same item must not appear in any cell
  // within ±2 columns and ±2 rows. This accounts for parallax drift
  // (max ~0.7 cells between col 0 and col 4 within a viewport).
  const n = allItems.length;
  const rowsPerColumn = n;
  const EXCL = 2;

  function itemKey(item) { return item.type + ':' + item.id; }

  // Build the grid: cols columns × n rows
  const grid = Array.from({ length: cols }, () => new Array(rowsPerColumn).fill(null));

  // Place items row by row, left to right
  const masterRng = makeRng(42);

  // Get items that conflict with the neighborhood of (c, r)
  function getNeighborItems(c, r) {
    const used = new Set();
    for (let dc = -EXCL; dc <= EXCL; dc++) {
      for (let dr = -EXCL; dr <= EXCL; dr++) {
        if (dc === 0 && dr === 0) continue;
        const nc = ((c + dc) % cols + cols) % cols;
        const nr = ((r + dr) % rowsPerColumn + rowsPerColumn) % rowsPerColumn;
        if (grid[nc][nr] !== null) {
          used.add(itemKey(grid[nc][nr]));
        }
      }
    }
    return used;
  }

  // Fill grid: for each column, place all n items exactly once
  for (let c = 0; c < cols; c++) {
    const remaining = shuffleArray([...allItems], makeRng(42 + c * 17));
    for (let r = 0; r < rowsPerColumn; r++) {
      const conflicts = getNeighborItems(c, r);

      // Find first non-conflicting item from remaining
      let bestIdx = -1;
      for (let i = 0; i < remaining.length; i++) {
        if (!conflicts.has(itemKey(remaining[i]))) {
          bestIdx = i;
          break;
        }
      }

      // Fallback: pick the item with maximum distance from its nearest neighbor
      if (bestIdx === -1) {
        let maxDist = -1;
        for (let i = 0; i < remaining.length; i++) {
          const key = itemKey(remaining[i]);
          let minDist = Infinity;
          for (let dc = -EXCL; dc <= EXCL; dc++) {
            const nc = ((c + dc) % cols + cols) % cols;
            for (let dr = -EXCL; dr <= EXCL; dr++) {
              if (dc === 0 && dr === 0) continue;
              const nr = ((r + dr) % rowsPerColumn + rowsPerColumn) % rowsPerColumn;
              if (grid[nc][nr] !== null && itemKey(grid[nc][nr]) === key) {
                const dist = Math.abs(dc) + Math.abs(dr);
                minDist = Math.min(minDist, dist);
              }
            }
          }
          if (minDist > maxDist) {
            maxDist = minDist;
            bestIdx = i;
          }
        }
      }

      grid[c][r] = remaining[bestIdx];
      remaining.splice(bestIdx, 1);
    }
  }

  // Extract columns from grid
  const gridColumns = grid;

  // Build column strips: 3 x-repeats × 2 y-repeats for infinite scroll
  const columnHTML = [];

  for (let colIdx = 0; colIdx < cols; colIdx++) {
    for (let xRepeat = -1; xRepeat <= 1; xRepeat++) {
      // 2 vertical copies for infinite Y wrap (reduces DOM from 1035 to 690 cells)
      let cellsHTML = '';
      for (let yRepeat = 0; yRepeat < 2; yRepeat++) {
        for (let r = 0; r < rowsPerColumn; r++) {
          cellsHTML += makeCellHTML(gridColumns[colIdx][r]);
        }
      }

      columnHTML.push(`
        <div class="artboard-column" data-col="${colIdx}" data-xrepeat="${xRepeat}">
          ${cellsHTML}
        </div>
      `);
    }
  }

  root.innerHTML = `
    <!-- SVG filter for liquid glass distortion -->
    <svg xmlns="http://www.w3.org/2000/svg" style="position:absolute;width:0;height:0;overflow:hidden;">
      <defs>
        <filter id="glass-distortion" x="0%" y="0%" width="100%" height="100%">
          <feTurbulence type="fractalNoise" baseFrequency="0.015" numOctaves="2" seed="92" result="noise" />
          <feGaussianBlur in="noise" stdDeviation="2" result="blurred" />
          <feDisplacementMap in="SourceGraphic" in2="blurred" scale="6" xChannelSelector="R" yChannelSelector="G" />
        </filter>
      </defs>
    </svg>

    <!-- CRT Scanline Overlay -->
    <div class="crt-overlay"></div>

    <!-- Top Bar -->
    <div class="top-bar">
      <div class="top-bar-left">
        <div class="top-bar-section">
          <div class="top-bar-heading">(Contact)</div>
          <div class="top-bar-label"><a href="${CONTACT.instagram}" target="_blank">Instagram</a></div>
          <div class="top-bar-label"><a href="mailto:${CONTACT.email}">Email</a></div>
        </div>
      </div>

      <div class="top-bar-bio">
        AWARD-WINNING FILMMAKER.<br>CREATES CINEMATIC FILMS AND VIDEOS AND MODERN TOOLS FOR STORYTELLING.
      </div>

      <div class="nav-buttons">
        <button class="nav-btn" onclick="showAbout()">About</button>
        <button class="nav-btn" onclick="showRumpusAI()">Rumpus A.I.</button>
      </div>
    </div>

    <!-- Bottom Bar -->
    <div class="bottom-bar">
      <div class="bottom-title" onclick="location.reload()">Philip<br>Di Fiore</div>
      <div class="bottom-hint">
        <button class="nav-btn" onclick="showChat()">Chat with A.I. Phil</button>
      </div>
    </div>

    <!-- Artboard — Column strips with per-column parallax -->
    <div class="artboard">
      ${columnHTML.join('')}
    </div>

    <!-- Detail Overlay -->
    <div class="detail-overlay">
      <div class="detail-inner"></div>
    </div>

    <!-- About Overlay -->
    <div class="about-overlay">
      <div class="about-inner">
        <button class="detail-back" onclick="closeOverlay()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back to Cinema Board
        </button>
        <h1 class="about-title">About</h1>
        <div class="about-content">${ABOUT_TEXT}</div>
      </div>
    </div>

    <!-- Rumpus AI Overlay -->
    <div class="rumpus-overlay">
      <div class="rumpus-inner">
        <button class="detail-back" onclick="closeOverlay()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back to Cinema Board
        </button>
        <h1 class="rumpus-title">Rumpus A.I.</h1>
        <p class="rumpus-subtitle">A suite of AI-powered tools built for the storytelling and creative community.</p>
        <div class="rumpus-grid">
          ${APPS.map(app => `
            <a href="${app.url}" target="_blank" class="rumpus-card">
              <div class="rumpus-card-img">
                <div class="rumpus-card-bg" style="background-image:url('${app.headerImage}')"></div>
              </div>
              <div class="rumpus-card-info">
                <div class="rumpus-card-title">${app.title}</div>
                <div class="rumpus-card-desc">${app.desc}</div>
              </div>
            </a>
          `).join('')}
        </div>
      </div>
    </div>

    <!-- Chat Overlay -->
    <div class="chat-overlay">
      <div class="chat-inner">
        <button class="detail-back" onclick="closeOverlay()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back to Cinema Board
        </button>
        <div class="chat-header-label">Chat with</div>
        <div class="chat-header-title">A.I. Phil</div>
        <div class="chat-area-dark">
          <div class="chat-messages-dark" id="chatMessagesContainer"></div>
          <div class="chat-preset-chips" id="chatChipsContainer">
            ${PRESET_QUESTIONS.map(q => `
              <button class="chat-chip" onclick="askPreset('${q.replace(/'/g, "\\'")}')">${q}</button>
            `).join('')}
          </div>
          <div class="chat-input-row-dark">
            <input type="text" class="chat-input-dark" placeholder="Ask me anything..." id="chatInput" />
            <button class="chat-send-btn" id="sendBtn">Send</button>
          </div>
        </div>
      </div>
    </div>
  `;

  // Attach chat listeners
  attachChatListeners();

  // Initialize artboard physics
  setTimeout(() => initArtboard(), 50);
}

function renderChat() {
  const container = document.getElementById('chatMessagesContainer');
  const chipsContainer = document.getElementById('chatChipsContainer');
  if (!container) return;

  if (chatMessages.length === 0 && !chatLoading) {
    container.innerHTML = '';
    if (chipsContainer) chipsContainer.style.display = 'flex';
    return;
  }

  if (chipsContainer) chipsContainer.style.display = 'none';

  container.innerHTML = chatMessages.map(msg => `
    <div class="msg ${msg.role}">${msg.content}</div>
  `).join('') + (chatLoading ? `
    <div class="msg assistant"><div class="dots"><span></span><span></span><span></span></div></div>
  ` : '');

  container.scrollTop = container.scrollHeight;
}

function attachChatListeners() {
  const input = document.getElementById('chatInput');
  const sendBtn = document.getElementById('sendBtn');

  if (input && sendBtn) {
    sendBtn.addEventListener('click', () => {
      const msg = input.value.trim();
      if (msg && !chatLoading) {
        sendChatMessage(msg);
        input.value = '';
      }
    });

    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const msg = input.value.trim();
        if (msg && !chatLoading) {
          sendChatMessage(msg);
          input.value = '';
        }
      }
    });
  }
}

// ==================== NAVIGATION ====================

function askPreset(question) {
  if (!chatLoading) {
    sendChatMessage(question);
  }
}

// Expose to global scope
window.showDetail = showDetail;
window.showAbout = showAbout;
window.showRumpusAI = showRumpusAI;
window.openProjectById = openProjectById;
window.showChat = showChat;
window.closeOverlay = closeOverlay;
window.askPreset = askPreset;

// ==================== INITIALIZE ====================

async function init() {
  // Show loading screen (placed in body, outside #root so renderArtboard won't destroy it)
  const loadingEl = document.createElement('div');
  loadingEl.className = 'loading-screen';
  loadingEl.id = 'loadingScreen';
  loadingEl.innerHTML = `
    <div class="loading-title">Philip Di Fiore</div>
    <div class="loading-bar-track">
      <div class="loading-bar-fill" id="loadingBar"></div>
    </div>
    <div class="loading-count" id="loadingCount">Loading...</div>
  `;
  document.body.appendChild(loadingEl);

  const bar = document.getElementById('loadingBar');
  const count = document.getElementById('loadingCount');

  // 1. Fetch project data from Supabase
  try {
    projects = await fetchProjects();
  } catch (error) {
    console.error('Failed to load projects:', error);
    projects = [];
  }

  // 2. Collect all unique image URLs (projects + apps)
  const imageURLs = new Set();
  projects.forEach(p => { if (p.featured_image) imageURLs.add(p.featured_image); });
  APPS.forEach(a => { if (a.headerImage) imageURLs.add(a.headerImage); });
  const urls = [...imageURLs];
  const total = urls.length;
  let loaded = 0;

  if (count) count.textContent = `0 / ${total}`;

  // 3. Preload every unique image
  await Promise.all(urls.map(url => {
    return new Promise(resolve => {
      const img = new Image();
      img.onload = img.onerror = () => {
        loaded++;
        const pct = Math.round((loaded / total) * 100);
        if (bar) bar.style.width = pct + '%';
        if (count) count.textContent = `${loaded} / ${total}`;
        resolve();
      };
      img.src = url;
    });
  }));

  // 4. All images cached — render the artboard (images will load instantly from cache)
  renderArtboard();

  // 5. Fade out loading screen
  const loadingScreen = document.getElementById('loadingScreen');
  if (loadingScreen) {
    loadingScreen.classList.add('fade-out');
    setTimeout(() => loadingScreen.remove(), 700);
  }
}

init();
</script>

</body>
</html>
